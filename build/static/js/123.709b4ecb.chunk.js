"use strict";(self.webpackChunkemployee_management_system=self.webpackChunkemployee_management_system||[]).push([[123],{1123:(e,t,s)=>{s.r(t),s.d(t,{default:()=>b});var a=s(5043),l=s(2543),r=s(6485),n=s(1372),o=s(2938),i=s(917),d=s(3458),c=s(7008),m=s(1490),x=s(4450),p=(s(5104),s(1425)),u=s(5016),h=s(579);const g=e=>{let{stats:t,tasks:s,filters:a,setFilters:r,employees:c}=e;const m=(e,t)=>{r(s=>({...s,[e]:t}))},x=[{title:"Total Tasks",value:t.total,icon:n.A,color:"bg-purple-500",bgColor:"bg-purple-50"},{title:"Tasks Completed",value:t.completed,icon:i.A,color:"bg-green-500",bgColor:"bg-green-50"},{title:"Tasks In Progress",value:t.inProgress,icon:d.A,color:"bg-blue-500",bgColor:"bg-blue-50"},{title:"Overdue Tasks",value:t.overdue,icon:l.A,color:"bg-red-500",bgColor:"bg-red-50"}];return(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,h.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Date Range"}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),(0,h.jsxs)("div",{className:"relative",children:[(0,h.jsx)("input",{type:"date",value:a.startDate,onChange:e=>m("startDate",e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),(0,h.jsx)(o.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),(0,h.jsxs)("div",{className:"relative",children:[(0,h.jsx)("input",{type:"date",value:a.endDate,onChange:e=>m("endDate",e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),(0,h.jsx)(o.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"})]})]})]})]}),(0,h.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:x.map((e,t)=>{const s=e.icon;return(0,h.jsx)("div",{className:`${e.bgColor} rounded-lg shadow p-6`,children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-sm font-medium text-gray-600",children:e.title}),(0,h.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:e.value})]}),(0,h.jsx)("div",{className:`p-3 rounded-lg ${e.color}`,children:(0,h.jsx)(s,{className:"w-6 h-6 text-white"})})]})},t)})}),(0,h.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,h.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,h.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Task List"})}),(0,h.jsx)("div",{className:"overflow-x-auto",children:(0,h.jsxs)("table",{className:"w-full text-sm text-left text-gray-500",children:[(0,h.jsx)("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{className:"px-6 py-3",children:"Task"}),(0,h.jsx)("th",{className:"px-6 py-3",children:"Assigned To"}),(0,h.jsx)("th",{className:"px-6 py-3",children:"Status"}),(0,h.jsx)("th",{className:"px-6 py-3",children:"Due Date"})]})}),(0,h.jsx)("tbody",{children:0===s.length?(0,h.jsx)("tr",{children:(0,h.jsx)("td",{colSpan:"4",className:"px-6 py-4 text-center text-gray-500",children:"No tasks found"})}):(s||[]).map(e=>(0,h.jsxs)("tr",{className:"bg-white border-b hover:bg-gray-50",children:[(0,h.jsx)("td",{className:"px-6 py-4 font-medium text-gray-900",children:e.title}),(0,h.jsx)("td",{className:"px-6 py-4",children:e.assigned_to||"N/A"}),(0,h.jsx)("td",{className:"px-6 py-4",children:(0,h.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full "+("Completed"===e.status?"bg-green-100 text-green-800":"In Progress"===e.status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:e.status||"To Do"})}),(0,h.jsx)("td",{className:"px-6 py-4",children:e.due_date?new Date(e.due_date).toLocaleDateString():"N/A"})]},e.id))})]})})]})]})},y=()=>{const[e,t]=(0,a.useState)([]),[s,l]=(0,a.useState)({startDate:"",endDate:"",employee:"",department:""}),[r,n]=(0,a.useState)([]),[o,i]=(0,a.useState)([]),[d,c]=(0,a.useState)(0);(0,a.useEffect)(()=>{(async()=>{const[e,s]=await Promise.all([fetch("http://localhost:5000/api/employees?all=true"),fetch("http://localhost:5000/api/departments")]);if(e.ok){const s=await e.json();t(Array.isArray(s.data)?s.data:Array.isArray(s)?s:[])}if(s.ok){const e=await s.json();n(Array.isArray(e.data)?e.data:Array.isArray(e)?e:[])}})();const e=new Date,s=new Date;s.setDate(e.getDate()-6);const a=e=>new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().slice(0,10);l(t=>({...t,startDate:a(s),endDate:a(e)}))},[]);const m=e=>{const t=parseInt(e,10)||0,s=Math.floor(t/3600),a=Math.floor(t%3600/60),l=t%60;return`${s}:${String(a).padStart(2,"0")}:${String(l).padStart(2,"0")}`};return(0,a.useEffect)(()=>{(async()=>{if(!s.startDate||!s.endDate)return;const e=new URLSearchParams({start:s.startDate,end:s.endDate});s.employee&&e.append("employee",s.employee),s.department&&e.append("department",s.department);const t=await fetch(`http://localhost:5000/api/reports/timelog?${e.toString()}`),a=t.ok?await t.json():{items:[],totalSeconds:0};i(a.items||[]),c(a.totalSeconds||0)})()},[s.startDate,s.endDate,s.employee,s.department]),(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,h.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Time Log Report"}),(0,h.jsxs)("div",{className:"text-sm text-gray-600",children:["Total: ",(0,h.jsx)("span",{className:"font-bold text-indigo-700",children:m(d)})]})]}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),(0,h.jsx)("input",{type:"date",value:s.startDate,onChange:e=>l(t=>({...t,startDate:e.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),(0,h.jsx)("input",{type:"date",value:s.endDate,onChange:e=>l(t=>({...t,endDate:e.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee"}),(0,h.jsxs)("select",{value:s.employee,onChange:e=>l(t=>({...t,employee:e.target.value})),className:"w-full border rounded px-3 py-2",children:[(0,h.jsx)("option",{value:"",children:"All"}),(e||[]).map(e=>(0,h.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),(0,h.jsxs)("select",{value:s.department,onChange:e=>l(t=>({...t,department:e.target.value})),className:"w-full border rounded px-3 py-2",children:[(0,h.jsx)("option",{value:"",children:"All"}),(r||[]).map(e=>(0,h.jsx)("option",{value:e.name,children:e.name},e.id))]})]})]})]}),(0,h.jsx)("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:(0,h.jsxs)("table",{className:"min-w-full text-sm",children:[(0,h.jsx)("thead",{className:"bg-gray-50 text-gray-700 uppercase text-xs",children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{className:"px-6 py-3 text-left",children:"Employee"}),(0,h.jsx)("th",{className:"px-6 py-3 text-left",children:"Task Name"}),(0,h.jsx)("th",{className:"px-6 py-3 text-left",children:"Date"}),(0,h.jsx)("th",{className:"px-6 py-3 text-left",children:"Label"}),(0,h.jsx)("th",{className:"px-6 py-3 text-left",children:"Priority"}),(0,h.jsx)("th",{className:"px-6 py-3 text-right",children:"Total Time"})]})}),(0,h.jsxs)("tbody",{children:[o.map((e,t)=>(0,h.jsxs)("tr",{className:"border-b",children:[(0,h.jsx)("td",{className:"px-6 py-3",children:e.employee_name}),(0,h.jsx)("td",{className:"px-6 py-3",children:e.task_title}),(0,h.jsx)("td",{className:"px-6 py-3",children:new Date(e.date).toLocaleDateString()}),(0,h.jsx)("td",{className:"px-6 py-3",children:e.labels||"-"}),(0,h.jsx)("td",{className:"px-6 py-3",children:e.priority||"-"}),(0,h.jsx)("td",{className:"px-6 py-3 text-right font-mono text-indigo-700",children:m(e.seconds)})]},t)),0===o.length&&(0,h.jsx)("tr",{children:(0,h.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-gray-500",children:"No data"})})]})]})})]})},f=()=>{const[e,t]=(0,a.useState)([]),[s,l]=(0,a.useState)({startDate:"",endDate:"",employee:"",department:""}),[r,n]=(0,a.useState)([]),[o,i]=(0,a.useState)([]),[d,c]=(0,a.useState)(0);(0,a.useEffect)(()=>{(async()=>{const[e,s]=await Promise.all([fetch("http://localhost:5000/api/employees?all=true"),fetch("http://localhost:5000/api/departments")]);if(e.ok){const s=await e.json();t(Array.isArray(s.data)?s.data:Array.isArray(s)?s:[])}if(s.ok){const e=await s.json();n(Array.isArray(e.data)?e.data:Array.isArray(e)?e:[])}})();const e=new Date,s=new Date;s.setDate(e.getDate()-6);const a=e=>new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().slice(0,10);l(t=>({...t,startDate:a(s),endDate:a(e)}))},[]);const m=e=>{const t=parseInt(e,10)||0,s=Math.floor(t/3600),a=Math.floor(t%3600/60),l=t%60;return`${s}:${String(a).padStart(2,"0")}:${String(l).padStart(2,"0")}`};return(0,a.useEffect)(()=>{(async()=>{if(!s.startDate||!s.endDate)return;const e=new URLSearchParams({start:s.startDate,end:s.endDate});s.employee&&e.append("employee",s.employee),s.department&&e.append("department",s.department);const t=await fetch(`http://localhost:5000/api/reports/timelog?${e.toString()}`),a=t.ok?await t.json():{items:[],totalSeconds:0},l=Array.isArray(a.items)?a.items:[],r=new Map;for(const s of l){const e=`${s.employee_name}||${s.task_title}||${s.labels||""}||${s.priority||""}`,t=parseInt(s.seconds||0,10)||0;r.has(e)||r.set(e,{employee_name:s.employee_name,task_title:s.task_title,labels:s.labels,priority:s.priority,seconds:0}),r.get(e).seconds+=t}const n=Array.from(r.values()).sort((e,t)=>(t.seconds||0)-(e.seconds||0)),o=n.reduce((e,t)=>e+(parseInt(t.seconds||0,10)||0),0);i(n),c(o)})()},[s.startDate,s.endDate,s.employee,s.department]),(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,h.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Consolidated Time Log Report"}),(0,h.jsxs)("div",{className:"text-sm text-gray-600",children:["Total: ",(0,h.jsx)("span",{className:"font-bold text-indigo-700",children:m(d)})]})]}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),(0,h.jsx)("input",{type:"date",value:s.startDate,onChange:e=>l(t=>({...t,startDate:e.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),(0,h.jsx)("input",{type:"date",value:s.endDate,onChange:e=>l(t=>({...t,endDate:e.target.value})),className:"w-full border rounded px-3 py-2"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee"}),(0,h.jsxs)("select",{value:s.employee,onChange:e=>l(t=>({...t,employee:e.target.value})),className:"w-full border rounded px-3 py-2",children:[(0,h.jsx)("option",{value:"",children:"All"}),(e||[]).map(e=>(0,h.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),(0,h.jsxs)("select",{value:s.department,onChange:e=>l(t=>({...t,department:e.target.value})),className:"w-full border rounded px-3 py-2",children:[(0,h.jsx)("option",{value:"",children:"All"}),(r||[]).map(e=>(0,h.jsx)("option",{value:e.name,children:e.name},e.id))]})]})]})]}),(0,h.jsx)("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:(0,h.jsxs)("table",{className:"min-w-full text-sm",children:[(0,h.jsx)("thead",{className:"bg-gray-50 text-gray-700 uppercase text-xs",children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{className:"px-6 py-3 text-left",children:"Employee"}),(0,h.jsx)("th",{className:"px-6 py-3 text-left",children:"Task Name"}),(0,h.jsx)("th",{className:"px-6 py-3 text-left",children:"Label"}),(0,h.jsx)("th",{className:"px-6 py-3 text-left",children:"Priority"}),(0,h.jsx)("th",{className:"px-6 py-3 text-right",children:"Total Time"})]})}),(0,h.jsxs)("tbody",{children:[o.map((e,t)=>(0,h.jsxs)("tr",{className:"border-b",children:[(0,h.jsx)("td",{className:"px-6 py-3",children:e.employee_name}),(0,h.jsx)("td",{className:"px-6 py-3",children:e.task_title}),(0,h.jsx)("td",{className:"px-6 py-3",children:e.labels||"-"}),(0,h.jsx)("td",{className:"px-6 py-3",children:e.priority||"-"}),(0,h.jsx)("td",{className:"px-6 py-3 text-right font-mono text-indigo-700",children:m(e.seconds)})]},t)),0===o.length&&(0,h.jsx)("tr",{children:(0,h.jsx)("td",{colSpan:"5",className:"px-6 py-4 text-center text-gray-500",children:"No data"})})]})]})})]})},j=e=>{let{stats:t,filters:s,setFilters:l,employees:r}=e;const[n,i]=(0,a.useState)([]),[d,c]=(0,a.useState)({open:!1,date:"",category:"",completed:!0,items:[],totalSeconds:0});(0,a.useEffect)(()=>{(async()=>{try{const e=await fetch("http://localhost:5000/api/departments");if(e.ok){const t=await e.json();i(Array.isArray(t.data)?t.data:Array.isArray(t)?t:[])}}catch(e){console.error("Error fetching departments:",e)}})()},[]),(0,a.useEffect)(()=>{const e=e=>{"Escape"===e.key&&d.open&&c(e=>({...e,open:!1}))};return d.open?(document.addEventListener("keydown",e),document.body.style.overflow="hidden"):document.body.style.overflow="unset",()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[d.open]);const m=(e,t)=>{l(s=>({...s,[e]:t}))},x=async(e,t,a)=>{try{const l=new Date(e),r=new Date(s.startDate),n=new Date(s.endDate);let o="";for(let t=new Date(r);t<=n;t.setDate(t.getDate()+1)){if(new Date(t).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})===e){o=new Date(t.getTime()-6e4*t.getTimezoneOffset()).toISOString().slice(0,10);break}}if(!o){o=new Date(l.getTime()-6e4*l.getTimezoneOffset()).toISOString().slice(0,10)}const i=new URLSearchParams({date:o,category:t,completed:String(a)});s.department&&i.append("department",s.department),s.employee&&i.append("employee",s.employee);const d=await fetch(`http://localhost:5000/api/reports/dwm/details?${i.toString()}`),m=d.ok?await d.json():{items:[],totalSeconds:0};c({open:!0,date:e,category:t,completed:a,items:m.items||[],totalSeconds:m.totalSeconds||0})}catch(l){console.error("Failed to open detail modal",l),c({open:!0,date:e,category:t,completed:a,items:[],totalSeconds:0})}},p=e=>{const t=Math.max(0,parseInt(e||0,10)),s=t%60,a=e=>e.toString().padStart(2,"0");return`${Math.floor(t/3600)}:${a(Math.floor(t%3600/60))}:${a(s)}`};return(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,h.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Filters"}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),(0,h.jsxs)("select",{value:s.department,onChange:e=>m("department",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,h.jsx)("option",{value:"",children:"Select..."}),(n||[]).map(e=>(0,h.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee"}),(0,h.jsxs)("select",{value:s.employee,onChange:e=>m("employee",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,h.jsx)("option",{value:"",children:"Select..."}),(r||[]).filter(e=>"Active"===e.status).map(e=>(0,h.jsxs)("option",{value:e.name,children:[e.name," (",e.employee_id,")"]},e.id))]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),(0,h.jsxs)("div",{className:"relative",children:[(0,h.jsx)("input",{type:"date",value:s.startDate,onChange:e=>m("startDate",e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),(0,h.jsx)(o.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),(0,h.jsxs)("div",{className:"relative",children:[(0,h.jsx)("input",{type:"date",value:s.endDate,onChange:e=>m("endDate",e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),(0,h.jsx)(o.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"})]})]})]})]}),(0,h.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,h.jsx)("div",{className:"overflow-x-auto",children:(0,h.jsxs)("table",{className:"w-full text-sm text-left text-gray-500",children:[(0,h.jsx)("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{className:"px-6 py-3 text-left",children:"Date"}),(0,h.jsx)("th",{className:"px-6 py-3 text-right",children:"Daily"}),(0,h.jsx)("th",{className:"px-6 py-3 text-right",children:"Weekly"}),(0,h.jsx)("th",{className:"px-6 py-3 text-right",children:"Monthly"})]})}),(0,h.jsx)("tbody",{children:t.map((e,t)=>(0,h.jsxs)("tr",{className:"bg-white border-b "+(t%2===0?"bg-gray-50":""),children:[(0,h.jsx)("td",{className:"px-6 py-4 font-medium text-gray-900",children:e.date}),(0,h.jsxs)("td",{className:"px-6 py-4 text-right",children:[(0,h.jsx)("button",{className:"text-indigo-600 hover:underline mr-1",onClick:()=>x(e.date,"daily",!0),title:"View completed tasks",children:String(e.daily).split("/")[0]}),"/",(0,h.jsx)("button",{className:"text-gray-600 hover:underline ml-1",onClick:()=>x(e.date,"daily",!1),title:"View not completed tasks",children:String(e.daily).split("/")[1]})]}),(0,h.jsx)("td",{className:"px-6 py-4 text-right",children:"N/A"===e.weekly?"N/A":(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("button",{className:"text-indigo-600 hover:underline mr-1",onClick:()=>x(e.date,"weekly",!0),children:String(e.weekly).split("/")[0]}),"/",(0,h.jsx)("button",{className:"text-gray-600 hover:underline ml-1",onClick:()=>x(e.date,"weekly",!1),children:String(e.weekly).split("/")[1]})]})}),(0,h.jsx)("td",{className:"px-6 py-4 text-right",children:"N/A"===e.monthly?"N/A":(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("button",{className:"text-indigo-600 hover:underline mr-1",onClick:()=>x(e.date,"monthly",!0),children:String(e.monthly).split("/")[0]}),"/",(0,h.jsx)("button",{className:"text-gray-600 hover:underline ml-1",onClick:()=>x(e.date,"monthly",!1),children:String(e.monthly).split("/")[1]})]})})]},t))})]})})}),d.open&&(0,h.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",onClick:e=>{e.target===e.currentTarget&&c(e=>({...e,open:!1}))},children:(0,h.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0",children:[(0,h.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:[d.completed?"Completed":"Not Completed"," ",d.category.toUpperCase()," tasks on ",d.date]}),(0,h.jsx)("button",{className:"text-gray-400 hover:text-gray-600 transition-colors duration-200 p-1 rounded-full hover:bg-gray-100",onClick:()=>c(e=>({...e,open:!1})),"aria-label":"Close modal",children:(0,h.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,h.jsx)("div",{className:"flex-1 overflow-hidden",children:0===d.items.length?(0,h.jsx)("div",{className:"p-6 text-center",children:(0,h.jsx)("p",{className:"text-gray-600",children:"No tasks found."})}):(0,h.jsx)("div",{className:"h-full overflow-y-auto",children:(0,h.jsx)("div",{className:"p-6",children:(0,h.jsx)("div",{className:"overflow-x-auto",children:(0,h.jsxs)("table",{className:"w-full text-sm",children:[(0,h.jsx)("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 sticky top-0",children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{className:"px-4 py-3 text-left font-medium",children:"Task Name"}),(0,h.jsx)("th",{className:"px-4 py-3 text-left font-medium",children:"Label"}),(0,h.jsx)("th",{className:"px-4 py-3 text-left font-medium",children:"Priority"}),(0,h.jsx)("th",{className:"px-4 py-3 text-right font-medium",children:"Time Spent"})]})}),(0,h.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:d.items.map((e,t)=>(0,h.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,h.jsx)("td",{className:"px-4 py-3 font-medium text-gray-900 max-w-xs truncate",title:e.title,children:e.title}),(0,h.jsx)("td",{className:"px-4 py-3 text-gray-600",children:e.labels||"-"}),(0,h.jsx)("td",{className:"px-4 py-3",children:(0,h.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+("High"===e.priority?"bg-red-100 text-red-800":"Medium"===e.priority?"bg-yellow-100 text-yellow-800":"Low"===e.priority?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.priority||"-"})}),(0,h.jsx)("td",{className:"px-4 py-3 text-right font-mono text-indigo-700 font-medium",children:p(e.seconds)})]},e.id||t))})]})})})})}),(0,h.jsxs)("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50 flex-shrink-0",children:[(0,h.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,h.jsx)("span",{className:"font-medium",children:d.items.length})," task",1!==d.items.length?"s":""," found"]}),(0,h.jsxs)("div",{className:"text-right",children:[(0,h.jsx)("div",{className:"text-sm text-gray-600",children:"Total Time:"}),(0,h.jsx)("div",{className:"font-semibold text-gray-900 text-lg",children:p(d.totalSeconds)})]})]})]})})]})},b=()=>{const{user:e}=(0,u.A)(),[t,s]=(0,a.useState)("task"),[l,n]=(0,a.useState)([]),[i,b]=(0,a.useState)([]),[N,v]=(0,a.useState)(!0),[w,D]=(0,a.useState)({startDate:"",endDate:"",department:"",assignedTo:"",status:"",priority:"",label:"",dueDateFrom:"",dueDateTo:""}),[k,S]=(0,a.useState)({department:"",employee:"",startDate:"2025-08-01",endDate:"2025-08-05"}),[A,C]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{v(!0);let t="http://localhost:5000/api/tasks";const s=new URLSearchParams;s.set("all","true"),e&&(s.set("user_id",e.id),s.set("role",e.role),s.set("employee_name",e.name||"")),k.department&&s.set("department",k.department),k.employee&&s.set("employee",k.employee);const a=s.toString();a&&(t+=`?${a}`);const l={};e&&(l["user-role"]=e.role||"employee",l["user-permissions"]=JSON.stringify(e.permissions||[]),l["user-name"]=e.name||"",console.log("\ud83d\udd0d Reports Debug - User Info:",{userRole:e.role,userName:e.name,userPermissions:e.permissions,employeeName:e.name||""}),console.log("\ud83d\udd0d Reports Debug - Request Headers:",l),console.log("\ud83d\udd0d Reports Debug - Request URL:",t));const[r,o]=await Promise.all([fetch(t,{headers:l}),fetch("http://localhost:5000/api/employees")]);if(r.ok&&o.ok){const e=await r.json(),t=await o.json();console.log("\ud83d\udd0d Reports Debug - Tasks Data:",e),console.log("\ud83d\udd0d Reports Debug - Tasks Count:",e.length),n(Array.isArray(e.data)?e.data:Array.isArray(e)?e:[]),b(Array.isArray(t.data)?t.data:Array.isArray(t)?t:[])}else console.error("\ud83d\udd0d Reports Debug - API Error:",{tasksStatus:r.status,employeesStatus:o.status})}catch(t){console.error("Error fetching data:",t)}finally{v(!1)}})()},[k.department,k.employee]);const T=(e,t)=>e.filter(e=>{var s;if(t.startDate&&e.created_at){if(new Date(e.created_at)<new Date(t.startDate))return!1}if(t.endDate&&e.created_at){if(new Date(e.created_at)>new Date(t.endDate))return!1}if(t.department&&e.department!==t.department)return!1;if(t.assignedTo&&e.assigned_to!==t.assignedTo)return!1;if(t.status&&e.status!==t.status)return!1;if(t.priority&&e.priority!==t.priority)return!1;if(t.label&&(null===(s=e.labels)||void 0===s||!s.toLowerCase().includes(t.label.toLowerCase())))return!1;if(t.dueDateFrom&&e.due_date){if(new Date(e.due_date)<new Date(t.dueDateFrom))return!1}if(t.dueDateTo&&e.due_date){if(new Date(e.due_date)>new Date(t.dueDateTo))return!1}return!0}),[_,L]=(0,a.useState)([]);(0,a.useEffect)(()=>{(async()=>{try{const{startDate:e,endDate:t,department:s,employee:a}=k;if(!e||!t)return void L([]);const l=new URLSearchParams({startDate:e,endDate:t});s&&l.append("department",s),a&&l.append("employee",a);const r=await fetch(`http://localhost:5000/api/reports/dwm?${l.toString()}`);if(r.ok){const e=await r.json();L(e)}else L([])}catch(e){console.error("Failed to load DWM aggregates",e),L([])}})()},[k.startDate,k.endDate,k.department,k.employee]);const $=(()=>{const e=T(l,w);return{total:e.length,completed:e.filter(e=>"Completed"===e.status).length,inProgress:e.filter(e=>"In Progress"===e.status).length,overdue:e.filter(e=>!!e.due_date&&(new Date(e.due_date)<new Date&&"Completed"!==e.status)).length}})(),E=(()=>{const{startDate:e,endDate:t,department:s,employee:a}=k;if(!e||!t)return[];const l=new Date(e),r=new Date(t);if(isNaN(l.getTime())||isNaN(r.getTime()))return[];const n=[];for(let i=new Date(l);i<=r;i.setDate(i.getDate()+1))n.push(new Date(i));const o=new URLSearchParams({startDate:e,endDate:t});return s&&o.append("department",s),a&&o.append("employee",a),function(e,t){return e.map(e=>{const s=new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().slice(0,10),a=e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),l=t.find(e=>e.day===s)||{daily_completed:0,daily_total:0,weekly_completed:0,weekly_total:0,monthly_completed:0,monthly_total:0};return{date:a,daily:`${l.daily_completed}/${l.daily_total}`,weekly:l.weekly_total>0?`${l.weekly_completed}/${l.weekly_total}`:"N/A",monthly:l.monthly_total>0?`${l.monthly_completed}/${l.monthly_total}`:"N/A"}})}(n,_)})(),P=[{id:"task",label:"Task Report",icon:r.A},{id:"timelog",label:"Time Log Report",icon:d.A},{id:"consolidated_timelog",label:"Consolidated Time Log Report",icon:d.A},{id:"dwm",label:"DWM Report",icon:o.A}];return(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Reports"}),(0,h.jsxs)("div",{className:"flex space-x-3",children:[(0,h.jsxs)(x.A,{variant:"outline",className:"flex items-center space-x-2 relative",onClick:()=>C(!0),children:[(0,h.jsx)(m.A,{className:"w-4 h-4"}),(0,h.jsx)("span",{children:"Filters"}),Object.values(w).some(e=>""!==e&&void 0!==e)&&(0,h.jsx)("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:Object.values(w).filter(e=>""!==e&&void 0!==e).length})]}),(0,h.jsxs)(x.A,{variant:"outline",className:"flex items-center space-x-2",children:[(0,h.jsx)(c.A,{className:"w-4 h-4"}),(0,h.jsx)("span",{children:"Export"})]})]})]}),(0,h.jsx)("div",{className:"border-b border-gray-200",children:(0,h.jsx)("nav",{className:"-mb-px flex space-x-8",children:P.map(e=>{const a=e.icon,l=t===e.id;return(0,h.jsxs)("button",{onClick:()=>s(e.id),className:`\n                  flex items-center space-x-2 py-2 px-1 border-b-2 font-medium text-sm\n                  ${l?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}\n                `,children:[(0,h.jsx)(a,{className:"w-4 h-4"}),(0,h.jsx)("span",{children:e.label})]},e.id)})})}),(0,h.jsxs)("div",{className:"mt-6",children:["task"===t&&(0,h.jsx)(g,{stats:$,tasks:T(l,w),filters:w,setFilters:D,employees:i}),"timelog"===t&&(0,h.jsx)(y,{}),"consolidated_timelog"===t&&(0,h.jsx)(f,{}),"dwm"===t&&(0,h.jsx)(j,{stats:E,filters:k,setFilters:S,employees:i})]}),(0,h.jsx)(p.A,{isOpen:A,onClose:()=>C(!1),title:"Filters",children:(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),(0,h.jsxs)("select",{value:w.department,onChange:e=>D(t=>({...t,department:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,h.jsx)("option",{value:"",children:"Select..."}),Array.from(new Set((i||[]).map(e=>e.department))).map(e=>(0,h.jsx)("option",{value:e,children:e},e))]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assigned To"}),(0,h.jsxs)("select",{value:w.assignedTo,onChange:e=>D(t=>({...t,assignedTo:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,h.jsx)("option",{value:"",children:"Select employees..."}),(i||[]).map(e=>(0,h.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),(0,h.jsxs)("select",{value:w.priority||"",onChange:e=>D(t=>({...t,priority:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,h.jsx)("option",{value:"",children:"Select..."}),(0,h.jsx)("option",{value:"High",children:"High"}),(0,h.jsx)("option",{value:"Medium",children:"Medium"}),(0,h.jsx)("option",{value:"Low",children:"Low"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Label"}),(0,h.jsxs)("select",{value:w.label||"",onChange:e=>D(t=>({...t,label:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,h.jsx)("option",{value:"",children:"Select..."}),(0,h.jsx)("option",{value:"Daily",children:"Daily"}),(0,h.jsx)("option",{value:"Weekly",children:"Weekly"}),(0,h.jsx)("option",{value:"Monthly",children:"Monthly"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,h.jsxs)("select",{value:w.status,onChange:e=>D(t=>({...t,status:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,h.jsx)("option",{value:"",children:"Select..."}),(0,h.jsx)("option",{value:"Pending",children:"Pending"}),(0,h.jsx)("option",{value:"In Progress",children:"In Progress"}),(0,h.jsx)("option",{value:"Completed",children:"Completed"}),(0,h.jsx)("option",{value:"Due",children:"Due"})]})]}),(0,h.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Due Date From"}),(0,h.jsx)("input",{type:"date",value:w.dueDateFrom||"",onChange:e=>D(t=>({...t,dueDateFrom:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Due Date To"}),(0,h.jsx)("input",{type:"date",value:w.dueDateTo||"",onChange:e=>D(t=>({...t,dueDateTo:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]})]}),(0,h.jsx)("div",{className:"flex justify-end pt-4",children:(0,h.jsx)(x.A,{variant:"secondary",onClick:()=>{D({startDate:"",endDate:"",department:"",assignedTo:"",status:"",priority:"",label:"",dueDateFrom:"",dueDateTo:""}),C(!1)},children:"Clear Filters"})})]})})]})}},5104:(e,t,s)=>{s.d(t,{A:()=>l});s(5043);var a=s(579);const l=e=>{let{label:t,name:s,type:l="text",placeholder:r="",required:n=!1,disabled:o=!1,defaultValue:i="",className:d="",onChange:c,error:m,...x}=e;return(0,a.jsxs)("div",{className:d,children:[t&&(0,a.jsxs)("label",{htmlFor:s,className:"block text-sm font-medium text-gray-700 mb-1",children:[t,n&&(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,a.jsx)("input",{id:s,name:s,type:l,placeholder:r,required:n,disabled:o,onChange:c,className:`\n          w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm\n          focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\n          disabled:bg-gray-50 disabled:text-gray-500\n          ${m?"border-red-500 focus:ring-red-500 focus:border-red-500":""}\n        `,...x}),m&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:m})]})}}}]);
//# sourceMappingURL=123.709b4ecb.chunk.js.map