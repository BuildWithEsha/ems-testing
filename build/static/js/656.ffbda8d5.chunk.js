"use strict";(self.webpackChunkemployee_management_system=self.webpackChunkemployee_management_system||[]).push([[656],{98:(e,t,s)=>{s.d(t,{A:()=>a});const a=(0,s(3797).A)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},2380:(e,t,s)=>{s.d(t,{A:()=>a});const a=(0,s(3797).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},4656:(e,t,s)=>{s.r(t),s.d(t,{default:()=>O});var a=s(5043),r=s(2380),i=s(9256),l=s(8775),n=s(399),c=s(6787),d=s(6339),o=s(3458),x=s(1425),m=s(4450),p=s(5104),u=s(3797);const y=(0,u.A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var h=s(98);const g=(0,u.A)("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]),j=(0,u.A)("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]),f=(0,u.A)("Underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]),b=(0,u.A)("Strikethrough",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]),N=(0,u.A)("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]),v=(0,u.A)("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),k=(0,u.A)("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]),w=(0,u.A)("AlignCenter",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"17",x2:"7",y1:"12",y2:"12",key:"rsh8ii"}],["line",{x1:"19",x2:"5",y1:"18",y2:"18",key:"1t0tuv"}]]),_=(0,u.A)("AlignRight",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}],["line",{x1:"21",x2:"7",y1:"18",y2:"18",key:"1g9eri"}]]),A=(0,u.A)("AlignJustify",[["line",{x1:"3",x2:"21",y1:"6",y2:"6",key:"4m8b97"}],["line",{x1:"3",x2:"21",y1:"12",y2:"12",key:"10d38w"}],["line",{x1:"3",x2:"21",y1:"18",y2:"18",key:"kwyyxn"}]]),C=(0,u.A)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),S=(0,u.A)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),T=(0,u.A)("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),E=(0,u.A)("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);var I=s(1172),R=s(8192);const L=(0,u.A)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);var $=s(5016),F=s(579);function M(e){let{ticket:t,onBack:s,onReplyAdded:r}=e;const{user:i}=(0,$.A)(),[l,c]=(0,a.useState)([]),[d,o]=(0,a.useState)(!0),[x,p]=(0,a.useState)(!1),[u,g]=(0,a.useState)(!1),[j,f]=(0,a.useState)({reply_text:"",reply_type:"customer_reply",is_internal:!1,attachments:[]}),b=(0,a.useRef)(!1),N=(0,a.useRef)(!1),v=(0,a.useRef)(null);(0,a.useEffect)(()=>{null!==t&&void 0!==t&&t.id&&(console.log("TicketDetail useEffect triggered for ticket:",t.id,"Previous:",v.current),v.current!==t.id&&(console.log("Ticket ID changed, resetting flags"),b.current=!1,N.current=!1,v.current=t.id),N.current||(console.log("Fetching replies for ticket:",t.id),w(),N.current=!0),b.current||(console.log("Marking ticket as read:",t.id),k(),b.current=!0))},[null===t||void 0===t?void 0:t.id]);const k=async()=>{if(null!==i&&void 0!==i&&i.id&&null!==t&&void 0!==t&&t.id)try{(await fetch("/api/notifications/mark-ticket-read",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:i.id,ticket_id:t.id})})).ok&&console.log("Notifications marked as read for ticket:",t.id)}catch(e){console.error("Error marking notifications as read:",e)}else console.log("Cannot mark ticket as read: missing user or ticket data")},w=async()=>{if(null===t||void 0===t||!t.id)return console.log("Cannot fetch replies: no ticket ID"),void o(!1);try{o(!0);const e=await fetch(`/api/tickets/${t.id}/replies`);if(e.ok){const t=await e.json();c(t)}}catch(e){console.error("Error fetching replies:",e)}finally{o(!1)}},_=()=>{const e=document.createElement("input");e.type="file",e.multiple=!0,e.accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.gif,.zip,.rar",e.onchange=e=>{const t=Array.from(e.target.files);t.length>0&&A(t)},e.click()},A=e=>{f(t=>({...t,attachments:[...t.attachments,...e]}))},C=e=>{f(t=>({...t,attachments:t.attachments.filter((t,s)=>s!==e)}))},S=e=>new Date(e).toLocaleString();return d?(0,F.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,F.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,F.jsxs)("div",{className:"h-full flex flex-col bg-white",children:[(0,F.jsx)("div",{className:"border-b border-gray-200 p-4",children:(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,F.jsxs)(m.A,{variant:"secondary",onClick:s,size:"sm",children:[(0,F.jsx)(y,{className:"w-4 h-4 mr-2"}),"Back"]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:t.title}),(0,F.jsxs)("p",{className:"text-sm text-gray-500",children:["Ticket #",t.ticket_number]})]})]}),(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${(e=>{switch(e){case"Critical":return"bg-red-100 text-red-800";case"High":return"bg-orange-100 text-orange-800";case"Medium":return"bg-yellow-100 text-yellow-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}})(t.priority)}`,children:t.priority}),(0,F.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${(e=>{switch(e){case"Open":return"bg-blue-100 text-blue-800";case"In Progress":return"bg-yellow-100 text-yellow-800";case"Resolved":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}})(t.status)}`,children:t.status})]})]})}),(0,F.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(0,F.jsx)("div",{className:"flex justify-start",children:(0,F.jsx)("div",{className:"max-w-3xl",children:(0,F.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)("span",{className:"text-sm font-medium text-gray-900",children:t.created_by_name}),(0,F.jsx)("span",{className:"text-xs text-gray-500",children:"\u2022"}),(0,F.jsx)("span",{className:"text-xs text-gray-500",children:S(t.created_at)})]}),(0,F.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Original Ticket"})]}),(0,F.jsx)("div",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:t.description})]})})}),l.map(e=>(0,F.jsx)("div",{className:"flex "+(e.is_internal?"justify-end":"justify-start"),children:(0,F.jsx)("div",{className:"max-w-3xl",children:(0,F.jsxs)("div",{className:"border rounded-lg p-4 "+(e.is_internal?"bg-yellow-50 border-yellow-200":"bg-white border-gray-200"),children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.replied_by_name}),e.is_internal&&(0,F.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Internal"}),(0,F.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:e.reply_type.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())})]}),(0,F.jsx)("span",{className:"text-xs text-gray-500",children:S(e.created_at)})]}),(0,F.jsx)("div",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:e.reply_text})]})})},e.id)),x&&(0,F.jsx)("div",{className:"flex justify-start",children:(0,F.jsx)("div",{className:"max-w-3xl w-full",children:(0,F.jsx)(U,{form:j,setForm:f,onSubmit:async()=>{if(j.reply_text.trim())try{const e=new FormData;e.append("reply_text",j.reply_text),e.append("reply_type",j.reply_type),e.append("is_internal",j.is_internal),e.append("replied_by",i.id),e.append("replied_by_name",i.name),j.attachments.forEach((t,s)=>{e.append(`attachment_${s}`,t)});const s=await fetch(`/api/tickets/${t.id}/replies`,{method:"POST",body:e});if(s.ok){const e=await s.json();c(t=>[...t,e]),f({reply_text:"",reply_type:"customer_reply",is_internal:!1,attachments:[]}),p(!1),r&&r(),window.dispatchEvent(new CustomEvent("ticketReplyAdded",{detail:{ticketId:t.id,userId:i.id}}))}else{const e=await s.json().catch(()=>({}));alert(`Failed to add reply: ${e.error||"Unknown error"}`)}}catch(e){console.error("Error adding reply:",e),alert("Failed to add reply")}else alert("Please enter a reply message")},onCancel:()=>p(!1),isNote:!1,onFileUpload:_,onRemoveAttachment:C})})}),u&&(0,F.jsx)("div",{className:"flex justify-end",children:(0,F.jsx)("div",{className:"max-w-3xl w-full",children:(0,F.jsx)(U,{form:j,setForm:f,onSubmit:async()=>{if(j.reply_text.trim())try{const e=new FormData;e.append("reply_text",j.reply_text),e.append("reply_type","internal_note"),e.append("is_internal","true"),e.append("replied_by",i.id),e.append("replied_by_name",i.name),j.attachments.forEach((t,s)=>{e.append(`attachment_${s}`,t)});const s=await fetch(`/api/tickets/${t.id}/replies`,{method:"POST",body:e});if(s.ok){const e=await s.json();c(t=>[...t,e]),f({reply_text:"",reply_type:"customer_reply",is_internal:!1,attachments:[]}),g(!1),r&&r(),window.dispatchEvent(new CustomEvent("ticketReplyAdded",{detail:{ticketId:t.id,userId:i.id}}))}else{const e=await s.json().catch(()=>({}));alert(`Failed to add note: ${e.error||"Unknown error"}`)}}catch(e){console.error("Error adding note:",e),alert("Failed to add note")}else alert("Please enter a note message")},onCancel:()=>g(!1),isNote:!0,onFileUpload:_,onRemoveAttachment:C})})})]}),(0,F.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,F.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,F.jsxs)(m.A,{onClick:()=>p(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[(0,F.jsx)(n.A,{className:"w-4 h-4 mr-2"}),"Reply"]}),(0,F.jsxs)(m.A,{variant:"secondary",onClick:()=>g(!0),children:[(0,F.jsx)(h.A,{className:"w-4 h-4 mr-2"}),"Add Note"]})]})})]})}function U(e){let{form:t,setForm:s,onSubmit:r,onCancel:i,isNote:l,onFileUpload:n,onRemoveAttachment:c}=e;const[d,o]=(0,a.useState)(!1),[x]=(0,a.useState)([]),p=e=>{console.log("Format:",e)};return(0,F.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[(0,F.jsxs)("div",{className:"mb-4",children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To:"}),(0,F.jsx)("input",{type:"text",value:"Customer",readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-600"})]}),(0,F.jsxs)("div",{className:"border border-gray-300 rounded-t-md",children:[(0,F.jsxs)("div",{className:"bg-gray-50 border-b border-gray-300 p-2 flex items-center space-x-2 flex-wrap",children:[(0,F.jsxs)("select",{className:"text-sm border border-gray-300 rounded px-2 py-1",children:[(0,F.jsx)("option",{children:"Normal"}),(0,F.jsx)("option",{children:"Heading 1"}),(0,F.jsx)("option",{children:"Heading 2"}),(0,F.jsx)("option",{children:"Heading 3"})]}),(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)("button",{onClick:()=>p("bold"),className:"p-1 hover:bg-gray-200 rounded",title:"Bold",children:(0,F.jsx)(g,{className:"w-4 h-4"})}),(0,F.jsx)("button",{onClick:()=>p("italic"),className:"p-1 hover:bg-gray-200 rounded",title:"Italic",children:(0,F.jsx)(j,{className:"w-4 h-4"})}),(0,F.jsx)("button",{onClick:()=>p("underline"),className:"p-1 hover:bg-gray-200 rounded",title:"Underline",children:(0,F.jsx)(f,{className:"w-4 h-4"})}),(0,F.jsx)("button",{onClick:()=>p("strikethrough"),className:"p-1 hover:bg-gray-200 rounded",title:"Strikethrough",children:(0,F.jsx)(b,{className:"w-4 h-4"})})]}),(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)("button",{onClick:()=>p("orderedList"),className:"p-1 hover:bg-gray-200 rounded",title:"Numbered List",children:(0,F.jsx)(N,{className:"w-4 h-4"})}),(0,F.jsx)("button",{onClick:()=>p("unorderedList"),className:"p-1 hover:bg-gray-200 rounded",title:"Bulleted List",children:(0,F.jsx)(v,{className:"w-4 h-4"})})]}),(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)("button",{onClick:()=>p("alignLeft"),className:"p-1 hover:bg-gray-200 rounded",title:"Align Left",children:(0,F.jsx)(k,{className:"w-4 h-4"})}),(0,F.jsx)("button",{onClick:()=>p("alignCenter"),className:"p-1 hover:bg-gray-200 rounded",title:"Align Center",children:(0,F.jsx)(w,{className:"w-4 h-4"})}),(0,F.jsx)("button",{onClick:()=>p("alignRight"),className:"p-1 hover:bg-gray-200 rounded",title:"Align Right",children:(0,F.jsx)(_,{className:"w-4 h-4"})}),(0,F.jsx)("button",{onClick:()=>p("alignJustify"),className:"p-1 hover:bg-gray-200 rounded",title:"Justify",children:(0,F.jsx)(A,{className:"w-4 h-4"})})]}),(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)("button",{onClick:()=>p("insertImage"),className:"p-1 hover:bg-gray-200 rounded",title:"Insert Image",children:(0,F.jsx)(C,{className:"w-4 h-4"})}),(0,F.jsx)("button",{onClick:()=>p("insertLink"),className:"p-1 hover:bg-gray-200 rounded",title:"Insert Link",children:(0,F.jsx)(S,{className:"w-4 h-4"})}),(0,F.jsx)("button",{onClick:()=>p("insertVideo"),className:"p-1 hover:bg-gray-200 rounded",title:"Insert Video",children:(0,F.jsx)(T,{className:"w-4 h-4"})})]})]}),(0,F.jsxs)("div",{className:"relative",children:[(0,F.jsx)("textarea",{value:t.reply_text,onChange:e=>s(t=>({...t,reply_text:e.target.value})),placeholder:l?"Add an internal note...":"Type your reply...",rows:6,className:"w-full px-3 py-2 border-0 focus:outline-none resize-none"}),(0,F.jsx)("button",{onClick:()=>o(!d),className:"absolute bottom-2 right-2 p-1 hover:bg-gray-100 rounded",title:"Insert Emoji",children:(0,F.jsx)(E,{className:"w-4 h-4 text-gray-500"})})]}),t.attachments.length>0&&(0,F.jsxs)("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:[(0,F.jsxs)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:["Attachments (",t.attachments.length,")"]}),(0,F.jsx)("div",{className:"space-y-2",children:t.attachments.map((e,t)=>(0,F.jsxs)("div",{className:"flex items-center justify-between bg-white p-2 rounded border",children:[(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)(h.A,{className:"w-4 h-4 text-gray-500 mr-2"}),(0,F.jsxs)("div",{children:[(0,F.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,F.jsxs)("p",{className:"text-xs text-gray-500",children:[(e.size/1024/1024).toFixed(2)," MB"]})]})]}),(0,F.jsx)("button",{onClick:()=>c(t),className:"text-red-500 hover:text-red-700 p-1",title:"Remove attachment",children:(0,F.jsx)(I.A,{className:"w-4 h-4"})})]},t))})]})]}),(0,F.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,F.jsxs)("button",{onClick:n,className:"flex items-center text-sm text-blue-600 hover:text-blue-800",children:[(0,F.jsx)(R.A,{className:"w-4 h-4 mr-1"}),"Upload File"]}),(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)("span",{className:"text-sm text-gray-500",children:"Templates:"}),(0,F.jsx)("div",{className:"bg-gray-100 border border-gray-300 rounded px-2 py-1 text-sm text-gray-600",children:"No template found"}),(0,F.jsxs)("button",{onClick:()=>{console.log("Apply template")},className:"flex items-center text-sm text-blue-600 hover:text-blue-800",children:[(0,F.jsx)(L,{className:"w-4 h-4 mr-1"}),"Apply Template"]})]})]}),(0,F.jsxs)("div",{className:"mt-4 flex items-center justify-end space-x-3",children:[(0,F.jsx)("button",{onClick:i,className:"text-sm text-gray-600 hover:text-gray-800",children:"Cancel"}),(0,F.jsxs)(m.A,{onClick:r,disabled:!t.reply_text.trim(),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[(0,F.jsx)(L,{className:"w-4 h-4 mr-2"}),"Submit"]})]})]})}function O(){const{user:e}=(0,$.A)(),[t,s]=(0,a.useState)([]),[o,u]=(0,a.useState)([]),[y,h]=(0,a.useState)([]),[g,j]=(0,a.useState)(!0),[f,b]=(0,a.useState)(""),[N,v]=(0,a.useState)(new Set);(0,a.useEffect)(()=>{if(null!==e&&void 0!==e&&e.id){const s=localStorage.getItem(`readTickets_${e.id}`);if(s)try{const e=JSON.parse(s);v(new Set(e))}catch(t){console.error("Error parsing saved read tickets:",t)}}},[null===e||void 0===e?void 0:e.id]);const k=()=>!(!e||!e.permissions)&&(e.permissions.includes("all")||e.permissions.includes("view_tickets")),w=()=>!(!e||!e.permissions)&&(e.permissions.includes("all")||e.permissions.includes("view_own_tickets")),_=()=>!(!e||!e.permissions)&&(e.permissions.includes("all")||e.permissions.includes("create_tickets")),A=t=>!(!e||!e.permissions)&&(!(!e.permissions.includes("all")&&!e.permissions.includes("edit_tickets"))||!!e.permissions.includes("edit_own_tickets")&&t.created_by===e.id),C=t=>(console.log("Checking delete permissions for ticket:",t),console.log("User:",e),console.log("User permissions:",null===e||void 0===e?void 0:e.permissions),e&&e.permissions?e.permissions.includes("all")||e.permissions.includes("delete_tickets")?(console.log("User has all permissions or delete_tickets permission"),!0):e.permissions.includes("edit_tickets")&&t.created_by===e.id?(console.log("User has edit_tickets permission and is ticket creator"),!0):(console.log("User has no delete permissions"),!1):(console.log("No user or permissions found"),!1)),S=()=>!(!e||!e.permissions)&&(e.permissions.includes("all")||e.permissions.includes("respond_to_tickets")),[T,E]=(0,a.useState)(!1),[I,R]=(0,a.useState)(!1),[L,U]=(0,a.useState)(!1),[O,D]=(0,a.useState)(!1),[H,q]=(0,a.useState)(null),[z,J]=(0,a.useState)(!1),[B,V]=(0,a.useState)({title:"",description:"",category:"",priority:"Medium",assigned_to:"",department:""}),[Z,Y]=(0,a.useState)({title:"",description:"",category:"",priority:"Medium",assigned_to:"",department:"",status:"Open"}),[G,K]=(0,a.useState)({reply_text:"",reply_type:"customer_reply",is_internal:!1}),Q=["Technical Support","HR Inquiry","General Support","Task Related","Feedback"],W=["Low","Medium","High","Critical"],X=async()=>{try{console.log("Fetching tickets..."),j(!0);const t={"Content-Type":"application/json"};e&&(t["user-role"]=e.role||"employee",t["user-permissions"]=JSON.stringify(e.permissions||[]),t["user-id"]=e.id||"",t["user-name"]=e.name||"");const a=await fetch("/api/tickets",{headers:t});if(a.ok){const e=await a.json();s(e)}}catch(t){console.error("Error fetching tickets:",t)}finally{j(!1)}};(0,a.useEffect)(()=>{X(),(async()=>{try{const[e,t]=await Promise.all([fetch("http://localhost:5000/api/employees"),fetch("http://localhost:5000/api/departments")]);if(e.ok&&t.ok){const[s,a]=await Promise.all([e.json(),t.json()]);u(Array.isArray(s.data)?s.data:Array.isArray(s)?s:[]),h(Array.isArray(a.data)?a.data:Array.isArray(a)?a:[])}}catch(e){console.error("Error fetching data:",e)}})()},[]),(0,a.useEffect)(()=>{if(null===e||void 0===e||!e.id)return;let t,s=!1;const a=async()=>{try{const t=await fetch(`/api/notifications?user_id=${e.id}`);if(!t.ok)return;const a=await t.json(),r=new Set((a||[]).filter(e=>e&&e.ticket_id&&0===e.is_read||!1===e.is_read).map(e=>e.ticket_id));if(s)return;r.size>0&&v(t=>{const s=new Set(t);let a=!1;if(r.forEach(e=>{s.has(e)&&(s.delete(e),a=!0)}),a)try{localStorage.setItem(`readTickets_${e.id}`,JSON.stringify([...s]))}catch{}return s})}catch(t){}};return a(),t=setInterval(a,1e4),()=>{s=!0,t&&clearInterval(t)}},[null===e||void 0===e?void 0:e.id]),(0,a.useEffect)(()=>{let t;const s=e=>{console.log("Notifications updated, refreshing ticket list...",e.detail),z?console.log("Skipping ticket list refresh - in detail view"):(t&&clearTimeout(t),t=setTimeout(()=>{X()},1e3))},a=s=>{console.log("Ticket reply added, refreshing ticket list...",s.detail);const{ticketId:a,userId:r}=s.detail||{};a&&null!==e&&void 0!==e&&e.id&&r!==e.id&&v(t=>{const s=new Set(t);s.delete(a);try{localStorage.setItem(`readTickets_${e.id}`,JSON.stringify([...s]))}catch(r){console.error("Failed saving unread state to localStorage",r)}return s}),t&&clearTimeout(t),t=setTimeout(()=>{X()},500)};return window.addEventListener("notificationsUpdated",s),window.addEventListener("ticketReplyAdded",a),()=>{window.removeEventListener("notificationsUpdated",s),window.removeEventListener("ticketReplyAdded",a),t&&clearTimeout(t)}},[]);const ee=e=>{q(e),Y({title:e.title||"",description:e.description||"",category:e.category||"",priority:e.priority||"Medium",assigned_to:e.assigned_to||"",department:e.department||"",status:e.status||"Open"}),R(!0)},te=async a=>{console.log("Attempting to delete ticket:",a),console.log("Current user:",e),console.log("User permissions:",null===e||void 0===e?void 0:e.permissions);const r=t.find(e=>e.id===a);if(r)if(console.log("Ticket to delete:",r),console.log("Can delete ticket?",C(r)),C(r))try{const e=await fetch(`/api/tickets/${a}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(e.ok)s(e=>e.filter(e=>e.id!==a)),alert("Ticket deleted successfully");else{const t=await e.json();alert(`Failed to delete ticket: ${t.error||"Unknown error"}`)}}catch(i){console.error("Error deleting ticket:",i),alert("Failed to delete ticket")}else alert("You do not have permission to delete this ticket.");else alert("Ticket not found")},se=t=>{q(t),J(!0);const s=new Set([...N,t.id]);v(s),null!==e&&void 0!==e&&e.id&&localStorage.setItem(`readTickets_${e.id}`,JSON.stringify([...s]))},ae=()=>{J(!1),q(null)},re=()=>{X()},ie=e=>{switch(e){case"Critical":return"bg-red-100 text-red-800";case"High":return"bg-orange-100 text-orange-800";case"Medium":return"bg-yellow-100 text-yellow-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},le=e=>{switch(e){case"Open":return"bg-blue-100 text-blue-800";case"In Progress":return"bg-yellow-100 text-yellow-800";case"Resolved":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return k()||w()?g?(0,F.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,F.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):z&&H?(0,F.jsx)(M,{ticket:H,onBack:ae,onReplyAdded:re}):(0,F.jsxs)("div",{className:"space-y-6",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Tickets"}),(0,F.jsx)("p",{className:"text-gray-600",children:"Manage employee communication and support requests"})]}),_()&&(0,F.jsxs)(m.A,{onClick:()=>E(!0),children:[(0,F.jsx)(r.A,{className:"w-4 h-4 mr-2"}),"Create Ticket"]})]}),(0,F.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:(0,F.jsxs)("div",{className:"relative",children:[(0,F.jsx)(i.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,F.jsx)(p.A,{type:"text",placeholder:"Search tickets...",value:f,onChange:e=>b(e.target.value),className:"pl-10"})]})}),(()=>{const e=t.filter(e=>{var t,s;return(null===(t=e.title)||void 0===t?void 0:t.toLowerCase().includes(f.toLowerCase()))||(null===(s=e.ticket_number)||void 0===s?void 0:s.toLowerCase().includes(f.toLowerCase()))}),s=e.filter(e=>!N.has(e.id)),a=e.filter(e=>N.has(e.id));return(0,F.jsxs)("div",{className:"space-y-6",children:[s.length>0&&(0,F.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[(0,F.jsx)("div",{className:"bg-blue-50 px-6 py-3 border-b border-gray-200",children:(0,F.jsxs)("h3",{className:"text-lg font-semibold text-blue-900 flex items-center",children:[(0,F.jsx)("span",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),"Unread Tickets (",s.length,")"]})}),(0,F.jsx)("div",{className:"overflow-x-auto",children:(0,F.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,F.jsx)("thead",{className:"bg-gray-50",children:(0,F.jsxs)("tr",{children:[(0,F.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ticket"}),(0,F.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),(0,F.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Priority"}),(0,F.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,F.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assign To"}),(0,F.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created By"}),(0,F.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,F.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>(0,F.jsxs)("tr",{className:"hover:bg-gray-50 bg-blue-50",children:[(0,F.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,F.jsxs)("div",{children:[(0,F.jsx)("button",{onClick:()=>se(e),className:"text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline text-left font-semibold",children:e.title}),(0,F.jsx)("div",{className:"text-sm text-gray-500",children:e.ticket_number})]})}),(0,F.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,F.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e.category})}),(0,F.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,F.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${ie(e.priority)}`,children:e.priority})}),(0,F.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,F.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${le(e.status)}`,children:e.status})}),(0,F.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,F.jsx)("div",{className:"text-sm text-gray-900",children:e.assigned_to_name||"Unassigned"}),(0,F.jsx)("div",{className:"text-sm text-gray-500",children:e.department||"N/A"})]}),(0,F.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,F.jsx)("div",{className:"text-sm text-gray-900",children:e.created_by_name||"N/A"}),(0,F.jsx)("div",{className:"text-sm text-gray-500",children:e.department_name||"N/A"})]}),(0,F.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(k()||w())&&(0,F.jsx)("button",{onClick:()=>se(e),className:"text-blue-600 hover:text-blue-900",title:"View Ticket",children:(0,F.jsx)(l.A,{className:"w-4 h-4"})}),S()&&(0,F.jsx)("button",{onClick:()=>se(e),className:"text-green-600 hover:text-green-900",title:"Add Response",children:(0,F.jsx)(n.A,{className:"w-4 h-4"})}),A(e)&&(0,F.jsx)("button",{onClick:()=>ee(e),className:"text-yellow-600 hover:text-yellow-900",title:"Edit Ticket",children:(0,F.jsx)(c.A,{className:"w-4 h-4"})}),C(e)&&(0,F.jsx)("button",{onClick:()=>{confirm("Are you sure you want to delete this ticket?")&&te(e.id)},className:"text-red-600 hover:text-red-900",title:"Delete Ticket",children:(0,F.jsx)(d.A,{className:"w-4 h-4"})})]})})]},e.id))})]})})]}),a.length>0&&(0,F.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[(0,F.jsx)("div",{className:"bg-gray-50 px-6 py-3 border-b border-gray-200",children:(0,F.jsxs)("h3",{className:"text-lg font-semibold text-gray-700 flex items-center",children:[(0,F.jsx)("span",{className:"w-3 h-3 bg-gray-400 rounded-full mr-2"}),"Read Tickets (",a.length,")"]})}),(0,F.jsx)("div",{className:"overflow-x-auto",children:(0,F.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,F.jsx)("thead",{className:"bg-gray-50",children:(0,F.jsxs)("tr",{children:[(0,F.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ticket"}),(0,F.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),(0,F.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Priority"}),(0,F.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,F.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assign To"}),(0,F.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created By"}),(0,F.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,F.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(e=>(0,F.jsxs)("tr",{className:"hover:bg-gray-50 opacity-75",children:[(0,F.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,F.jsxs)("div",{children:[(0,F.jsx)("button",{onClick:()=>se(e),className:"text-sm font-medium text-gray-600 hover:text-gray-800 hover:underline text-left",children:e.title}),(0,F.jsx)("div",{className:"text-sm text-gray-500",children:e.ticket_number})]})}),(0,F.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,F.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e.category})}),(0,F.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,F.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${ie(e.priority)}`,children:e.priority})}),(0,F.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,F.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${le(e.status)}`,children:e.status})}),(0,F.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,F.jsx)("div",{className:"text-sm text-gray-900",children:e.assigned_to_name||"Unassigned"}),(0,F.jsx)("div",{className:"text-sm text-gray-500",children:e.department||"N/A"})]}),(0,F.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,F.jsx)("div",{className:"text-sm text-gray-900",children:e.created_by_name||"N/A"}),(0,F.jsx)("div",{className:"text-sm text-gray-500",children:e.department_name||"N/A"})]}),(0,F.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(k()||w())&&(0,F.jsx)("button",{onClick:()=>se(e),className:"text-blue-600 hover:text-blue-900",title:"View Ticket",children:(0,F.jsx)(l.A,{className:"w-4 h-4"})}),S()&&(0,F.jsx)("button",{onClick:()=>se(e),className:"text-green-600 hover:text-green-900",title:"Add Response",children:(0,F.jsx)(n.A,{className:"w-4 h-4"})}),A(e)&&(0,F.jsx)("button",{onClick:()=>ee(e),className:"text-yellow-600 hover:text-yellow-900",title:"Edit Ticket",children:(0,F.jsx)(c.A,{className:"w-4 h-4"})}),C(e)&&(0,F.jsx)("button",{onClick:()=>{confirm("Are you sure you want to delete this ticket?")&&te(e.id)},className:"text-red-600 hover:text-red-900",title:"Delete Ticket",children:(0,F.jsx)(d.A,{className:"w-4 h-4"})})]})})]},e.id))})]})})]}),0===e.length&&(0,F.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center",children:(0,F.jsxs)("div",{className:"text-gray-500",children:[(0,F.jsx)(n.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,F.jsx)("p",{className:"text-lg font-medium",children:"No tickets found"}),(0,F.jsx)("p",{className:"text-sm",children:"Try adjusting your search terms or create a new ticket."})]})})]})})(),(0,F.jsxs)(x.A,{isOpen:T,onClose:()=>E(!1),title:"Create New Ticket",size:"lg",children:[(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),(0,F.jsx)(p.A,{value:B.title,onChange:e=>V(t=>({...t,title:e.target.value})),placeholder:"Enter ticket title"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,F.jsx)("textarea",{value:B.description,onChange:e=>V(t=>({...t,description:e.target.value})),placeholder:"Enter ticket description",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,F.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category *"}),(0,F.jsxs)("select",{value:B.category,onChange:e=>V(t=>({...t,category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,F.jsx)("option",{value:"",children:"Select Category"}),Q.map(e=>(0,F.jsx)("option",{value:e,children:e},e))]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),(0,F.jsx)("select",{value:B.priority,onChange:e=>V(t=>({...t,priority:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:W.map(e=>(0,F.jsx)("option",{value:e,children:e},e))})]})]}),(0,F.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assign To"}),(0,F.jsxs)("select",{value:B.assigned_to,onChange:e=>V(t=>({...t,assigned_to:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,F.jsx)("option",{value:"",children:"Select Employee"}),(o||[]).map(e=>(0,F.jsxs)("option",{value:e.id,children:[e.name," (",e.department,")"]},e.id))]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),(0,F.jsxs)("select",{value:B.department,onChange:e=>V(t=>({...t,department:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,F.jsx)("option",{value:"",children:"Select Department"}),(y||[]).map(e=>(0,F.jsx)("option",{value:e.name,children:e.name},e.id))]})]})]})]}),(0,F.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,F.jsx)(m.A,{variant:"secondary",onClick:()=>E(!1),children:"Cancel"}),(0,F.jsx)(m.A,{onClick:async()=>{if(_())try{const t=await fetch("/api/tickets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...B,created_by:e.id})});if(t.ok){const e=await t.json();s(t=>[e,...t]),E(!1),V({title:"",description:"",category:"",priority:"Medium",assigned_to:"",department:""})}}catch(t){console.error("Error creating ticket:",t),alert("Failed to create ticket")}else alert("You do not have permission to create tickets.")},disabled:!B.title||!B.category,children:"Create Ticket"})]})]}),(0,F.jsxs)(x.A,{isOpen:I,onClose:()=>R(!1),title:"Edit Ticket",size:"lg",children:[(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),(0,F.jsx)(p.A,{value:Z.title,onChange:e=>Y(t=>({...t,title:e.target.value})),placeholder:"Enter ticket title"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,F.jsx)("textarea",{value:Z.description,onChange:e=>Y(t=>({...t,description:e.target.value})),placeholder:"Enter ticket description",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,F.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category *"}),(0,F.jsxs)("select",{value:Z.category,onChange:e=>Y(t=>({...t,category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,F.jsx)("option",{value:"",children:"Select Category"}),Q.map(e=>(0,F.jsx)("option",{value:e,children:e},e))]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),(0,F.jsx)("select",{value:Z.priority,onChange:e=>Y(t=>({...t,priority:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:W.map(e=>(0,F.jsx)("option",{value:e,children:e},e))})]})]}),(0,F.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,F.jsx)("select",{value:Z.status,onChange:e=>Y(t=>({...t,status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:["Open","In Progress","Resolved","Closed"].map(e=>(0,F.jsx)("option",{value:e,children:e},e))})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assign To"}),(0,F.jsxs)("select",{value:Z.assigned_to,onChange:e=>Y(t=>({...t,assigned_to:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,F.jsx)("option",{value:"",children:"Select Employee"}),(o||[]).map(e=>(0,F.jsxs)("option",{value:e.id,children:[e.name," (",e.department,")"]},e.id))]})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),(0,F.jsxs)("select",{value:Z.department,onChange:e=>Y(t=>({...t,department:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,F.jsx)("option",{value:"",children:"Select Department"}),(y||[]).map(e=>(0,F.jsx)("option",{value:e.name,children:e.name},e.id))]})]})]}),(0,F.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,F.jsx)(m.A,{variant:"secondary",onClick:()=>R(!1),children:"Cancel"}),(0,F.jsx)(m.A,{onClick:async()=>{try{const t=await fetch(`/api/tickets/${H.id}`,{method:"PUT",headers:{"Content-Type":"application/json","user-role":e.role||"employee","user-permissions":JSON.stringify(e.permissions||[]),"user-id":e.id||"","user-name":e.name||""},body:JSON.stringify(Z)});if(t.ok){const e=await t.json();s(t=>t.map(t=>t.id===H.id?e:t)),R(!1),q(null),alert("Ticket updated successfully")}else{const e=await t.json();alert(`Failed to update ticket: ${e.error||"Unknown error"}`)}}catch(t){console.error("Error updating ticket:",t),alert("Failed to update ticket")}},disabled:!Z.title||!Z.category,children:"Update Ticket"})]})]}),(0,F.jsxs)(x.A,{isOpen:L,onClose:()=>U(!1),title:`Ticket: ${null===H||void 0===H?void 0:H.ticket_number}`,size:"xl",children:[H&&(0,F.jsxs)("div",{className:"space-y-6",children:[(0,F.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,F.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:H.title}),(0,F.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:H.description})]}),(0,F.jsxs)("div",{className:"space-y-2",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Status:"}),(0,F.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${le(H.status)}`,children:H.status})]}),(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Priority:"}),(0,F.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${ie(H.priority)}`,children:H.priority})]}),(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Category:"}),(0,F.jsx)("span",{className:"text-sm text-gray-900",children:H.category})]})]})]})}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,F.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Replies & Updates"}),S()&&(0,F.jsxs)(m.A,{onClick:()=>{U(!1),D(!0)},size:"sm",children:[(0,F.jsx)(n.A,{className:"w-4 h-4 mr-2"}),"Add Reply"]})]}),(0,F.jsx)(P,{ticketId:H.id})]})]}),(0,F.jsx)("div",{className:"flex justify-end mt-6",children:(0,F.jsx)(m.A,{variant:"secondary",onClick:()=>U(!1),children:"Close"})})]}),(0,F.jsxs)(x.A,{isOpen:O,onClose:()=>D(!1),title:`Reply to Ticket: ${null===H||void 0===H?void 0:H.ticket_number}`,size:"lg",children:[(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reply Message *"}),(0,F.jsx)("textarea",{value:G.reply_text,onChange:e=>K(t=>({...t,reply_text:e.target.value})),placeholder:"Enter your reply message...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,F.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reply Type"}),(0,F.jsxs)("select",{value:G.reply_type,onChange:e=>K(t=>({...t,reply_type:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,F.jsx)("option",{value:"customer_reply",children:"Customer Reply"}),(0,F.jsx)("option",{value:"internal_note",children:"Internal Note"}),(0,F.jsx)("option",{value:"status_update",children:"Status Update"})]})]}),(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("input",{type:"checkbox",id:"is_internal",checked:G.is_internal,onChange:e=>K(t=>({...t,is_internal:e.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,F.jsx)("label",{htmlFor:"is_internal",className:"ml-2 block text-sm text-gray-900",children:"Internal Note (not visible to customer)"})]})]})]}),(0,F.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,F.jsx)(m.A,{variant:"secondary",onClick:()=>D(!1),children:"Cancel"}),(0,F.jsx)(m.A,{onClick:async()=>{if(G.reply_text.trim())try{const t=await fetch(`/api/tickets/${H.id}/replies`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...G,replied_by:e.id,replied_by_name:e.name})});if(t.ok){await t.json();K({reply_text:"",reply_type:"customer_reply",is_internal:!1}),D(!1),alert("Reply added successfully"),X()}else{const e=await t.json();alert(`Failed to add reply: ${e.error||"Unknown error"}`)}}catch(t){console.error("Error adding reply:",t),alert("Failed to add reply")}else alert("Please enter a reply message")},disabled:!G.reply_text.trim(),children:"Send Reply"})]})]})]}):(0,F.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,F.jsxs)("div",{className:"text-center",children:[(0,F.jsx)("div",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),(0,F.jsx)("div",{className:"text-gray-600",children:"You don't have permission to view tickets."})]})})}function P(e){let{ticketId:t}=e;const[s,r]=(0,a.useState)([]),[i,l]=(0,a.useState)(!0);(0,a.useEffect)(()=>{t&&c()},[t]);const c=async()=>{try{l(!0);const e=await fetch(`/api/tickets/${t}/replies`);if(e.ok){const t=await e.json();r(t)}}catch(e){console.error("Error fetching replies:",e)}finally{l(!1)}};return i?(0,F.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,F.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):0===s.length?(0,F.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,F.jsx)(n.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,F.jsx)("p",{children:"No replies yet"}),(0,F.jsx)("p",{className:"text-sm",children:"Be the first to add a reply to this ticket"})]}):(0,F.jsx)("div",{className:"space-y-4",children:s.map(e=>{return(0,F.jsxs)("div",{className:"border rounded-lg p-4 "+(e.is_internal?"bg-yellow-50 border-yellow-200":"bg-white border-gray-200"),children:[(0,F.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.replied_by_name}),e.is_internal&&(0,F.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Internal"}),(0,F.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e.reply_type.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())})]}),(0,F.jsxs)("div",{className:"flex items-center text-xs text-gray-500",children:[(0,F.jsx)(o.A,{className:"w-3 h-3 mr-1"}),(t=e.created_at,new Date(t).toLocaleString())]})]}),(0,F.jsx)("div",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:e.reply_text})]},e.id);var t})})}},5104:(e,t,s)=>{s.d(t,{A:()=>r});s(5043);var a=s(579);const r=e=>{let{label:t,name:s,type:r="text",placeholder:i="",required:l=!1,disabled:n=!1,defaultValue:c="",className:d="",onChange:o,error:x,...m}=e;return(0,a.jsxs)("div",{className:d,children:[t&&(0,a.jsxs)("label",{htmlFor:s,className:"block text-sm font-medium text-gray-700 mb-1",children:[t,l&&(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,a.jsx)("input",{id:s,name:s,type:r,placeholder:i,required:l,disabled:n,onChange:o,className:`\n          w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm\n          focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\n          disabled:bg-gray-50 disabled:text-gray-500\n          ${x?"border-red-500 focus:ring-red-500 focus:border-red-500":""}\n        `,...m}),x&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:x})]})}},6787:(e,t,s)=>{s.d(t,{A:()=>a});const a=(0,s(3797).A)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},8192:(e,t,s)=>{s.d(t,{A:()=>a});const a=(0,s(3797).A)("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]])}}]);
//# sourceMappingURL=656.ffbda8d5.chunk.js.map