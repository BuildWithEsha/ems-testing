"use strict";(self.webpackChunkemployee_management_system=self.webpackChunkemployee_management_system||[]).push([[833],{98:(e,s,i)=>{i.d(s,{A:()=>n});const n=(0,i(3797).A)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},2380:(e,s,i)=>{i.d(s,{A:()=>n});const n=(0,i(3797).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},3833:(e,s,i)=>{i.r(s),i.d(s,{default:()=>v});var n=i(5043),r=i(5016),o=i(7219),a=i(6852),t=i(8112),l=i(98),c=i(2938),d=i(399),m=i(430),p=i(8283),g=i(2380),h=i(6787),y=i(6339),x=i(917),u=i(3666),f=i(8432),b=i(579);const j=()=>{const[e,s]=(0,n.useState)([]),[i,r]=(0,n.useState)(null),[j,v]=(0,n.useState)(!1),[N,w]=(0,n.useState)(null),[k,A]=(0,n.useState)(new Set),[P,S]=(0,n.useState)({name:"",description:"",permissions:[]}),[C,E]=(0,n.useState)(!1),[M,$]=(0,n.useState)(null),[T,R]=(0,n.useState)([]);(0,n.useEffect)(()=>{L(),z()},[]),(0,n.useEffect)(()=>{const e=()=>{console.log("\ud83d\udd04 PermissionsManager component focused - refreshing data..."),L()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[]);const L=async()=>{try{v(!0);const e=await fetch("/api/roles");if(!e.ok)throw new Error("Failed to fetch roles");{const n=await e.json();if(console.log("\ud83d\udd0d Fetched roles data:",n),n.forEach(e=>{console.log(`\ud83d\udd0d Role "${e.name}" permissions:`,{type:typeof e.permissions,value:e.permissions,isArray:Array.isArray(e.permissions)})}),s(n),n.length>0)if(i){const e=n.find(e=>e.id===i.id);r(e||n[0])}else r(n[0])}}catch(e){w(e.message)}finally{v(!1)}},z=async()=>{try{const e=await fetch("/api/permissions");if(!e.ok)throw new Error("Failed to fetch permissions");{const s=await e.json(),i=[{id:"sidebar",name:"Sidebar Navigation",icon:o.A,description:"PHASE 2: Control which sidebar menu items users can see",permissions:s.filter(e=>"Sidebar Navigation"===e.category)},{id:"dashboard",name:"Dashboard",icon:a.A,description:"Access to main dashboard and overview",permissions:s.filter(e=>"Dashboard"===e.category||e.name.includes("dashboard"))},{id:"employees",name:"Employees",icon:t.A,description:"Manage employee information and records",permissions:s.filter(e=>"Employees"===e.category||e.name.includes("employee"))},{id:"tasks",name:"Tasks",icon:l.A,description:"Manage and assign tasks",permissions:s.filter(e=>"Task Management"===e.category||e.name.toLowerCase().includes("task")||e.name.toLowerCase().includes("timer"))},{id:"attendance",name:"Attendance",icon:c.A,description:"Track employee attendance and time",permissions:s.filter(e=>"Attendance"===e.category||e.name.includes("attendance"))},{id:"tickets",name:"Tickets",icon:d.A,description:"Manage support tickets and communication",permissions:s.filter(e=>"Tickets"===e.category||e.name.includes("ticket"))},{id:"notice_board",name:"Notice Board",icon:m.A,description:"Manage company notices and announcements",permissions:s.filter(e=>"Notice Board"===e.category||e.name.includes("notice"))},{id:"reports",name:"Reports",icon:a.A,description:"Generate and view various reports",permissions:s.filter(e=>"Reports"===e.category||e.name.includes("report"))},{id:"settings",name:"Settings",icon:o.A,description:"System configuration and user management",permissions:s.filter(e=>"Settings"===e.category||e.name.includes("setting"))},{id:"notifications",name:"Notifications",icon:p.A,description:"Control access to different types of notifications",permissions:s.filter(e=>"Notifications"===e.category||e.name.includes("dwm_view")||e.name.includes("clet_view")||e.name.includes("ca_view"))}];console.log("Loaded permissions from database:",s),console.log("Grouped into modules:",i);const n=i.find(e=>"tasks"===e.id);n&&(console.log("\ud83d\udd0d Tasks Module Debug:"),console.log("  - Total permissions found:",n.permissions.length),console.log("  - Permissions:",n.permissions.map(e=>`${e.name} (${e.category})`)),console.log("\ud83d\udd0d Raw permissions data:"),console.log("  - All permissions count:",s.length),console.log('  - Permissions with "task" in name:',s.filter(e=>e.name.toLowerCase().includes("task")).length),console.log('  - Permissions with "timer" in name:',s.filter(e=>e.name.toLowerCase().includes("timer")).length),console.log('  - Permissions with category "Task Management":',s.filter(e=>"Task Management"===e.category).length)),R(i)}}catch(e){w(e.message)}},O=(e,s)=>{if(!e||!e.permissions)return console.log(`\ud83d\udd0d getPermissionValue: No role or permissions for ${s}`,{role:e}),!1;let i;try{if("string"===typeof e.permissions)i=JSON.parse(e.permissions),console.log(`\ud83d\udd0d Parsed string permissions for role ${e.name}:`,i);else if(Array.isArray(e.permissions))i=e.permissions,console.log(`\ud83d\udd0d Using array permissions for role ${e.name}:`,i);else if(null===e.permissions||void 0===e.permissions)i=[],console.log(`\ud83d\udd0d No permissions for role ${e.name}, using empty array`);else{if("object"===typeof e.permissions&&!Array.isArray(e.permissions)){const i=!0===e.permissions[s];return console.log(`\ud83d\udd0d Object permissions for role ${e.name}, ${s}: ${i}`),i}console.warn("Unexpected permissions format in getPermissionValue:",e.permissions),i=[]}Array.isArray(i)||(console.warn("Permissions is not an array after parsing in getPermissionValue, resetting to empty array"),i=[])}catch(r){console.error("Error parsing permissions in getPermissionValue:",r),i=[]}if(i.includes("all"))return console.log(`\ud83d\udd0d Permission check for ${s} in role ${e.name}: true (permissions: all - universal grant)`),!0;const n=i.includes(s);return console.log(`\ud83d\udd0d Permission check for ${s} in role ${e.name}: ${n} (permissions: ${JSON.stringify(i)})`),console.log(`\ud83d\udd0d Looking for: "${s}" in array: [${i.map(e=>`"${e}"`).join(", ")}]`),n};return console.log("\ud83d\udd0d PermissionsManager render state:",{loading:j,rolesCount:e.length,permissionModulesCount:T.length,selectedRole:i?{id:i.id,name:i.name,permissionsType:typeof i.permissions,permissionsValue:i.permissions,permissionsCount:i.permissions?Array.isArray(i.permissions)?i.permissions.length:"not array":"no permissions"}:"no role selected"}),i&&i.permissions&&console.log("\ud83d\udd0d Selected Role Permissions Debug:",{roleName:i.name,permissionsType:typeof i.permissions,permissionsRaw:i.permissions,permissionsParsed:"string"===typeof i.permissions?JSON.parse(i.permissions):i.permissions}),!j||0!==e.length&&0!==T.length?(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Roles & Permissions Management"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Manage user roles and their access permissions across different modules"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,b.jsx)("div",{className:"lg:col-span-1",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Roles"}),(0,b.jsxs)("button",{onClick:()=>{E(!0),S({name:"",description:"",permissions:[]})},className:"bg-blue-600 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-700 flex items-center gap-2",children:[(0,b.jsx)(g.A,{size:16}),"Add Role"]})]}),(0,b.jsx)("div",{className:"space-y-2",children:e.map(s=>(0,b.jsx)("div",{className:"p-3 rounded-md cursor-pointer transition-colors "+((null===i||void 0===i?void 0:i.id)===s.id?"bg-blue-100 border border-blue-300":"bg-gray-50 hover:bg-gray-100"),onClick:()=>r(s),children:(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-gray-900",children:s.name}),s.description&&(0,b.jsx)("div",{className:"text-sm text-gray-500",children:s.description})]}),(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsx)("button",{onClick:e=>{e.stopPropagation(),(e=>{$(e),S({name:e.name,description:e.description||"",permissions:e.permissions||[]})})(s)},className:"text-blue-600 hover:text-blue-800 p-1",children:(0,b.jsx)(h.A,{size:14})}),(0,b.jsx)("button",{onClick:n=>{n.stopPropagation(),(async s=>{if(confirm("Are you sure you want to delete this role?"))try{if(v(!0),!(await fetch(`/api/roles/${s}`,{method:"DELETE"})).ok)throw new Error("Failed to delete role");await L(),(null===i||void 0===i?void 0:i.id)===s&&r(e.find(e=>e.id!==s)||null)}catch(n){w(n.message),alert("Error deleting role: "+n.message)}finally{v(!1)}})(s.id)},className:"text-red-600 hover:text-red-800 p-1",children:(0,b.jsx)(y.A,{size:14})})]})]})},s.id))}),(C||M)&&(0,b.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-md",children:[(0,b.jsx)("h4",{className:"font-medium mb-3",children:M?"Edit Role":"Add New Role"}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("input",{type:"text",placeholder:"Role Name",value:P.name,onChange:e=>S({...P,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,b.jsx)("input",{type:"text",placeholder:"Description (optional)",value:P.description,onChange:e=>S({...P,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:async()=>{try{v(!0);const e=M?`/api/roles/${M.id}`:"/api/roles",s=M?"PUT":"POST";if(!(await fetch(e,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify({...P,permissions:P.permissions||[]})})).ok)throw new Error("Failed to save role");await L(),E(!1),$(null),S({name:"",description:"",permissions:[]})}catch(e){w(e.message),alert("Error saving role: "+e.message)}finally{v(!1)}},className:"bg-blue-600 text-white px-3 py-2 rounded-md text-sm hover:bg-blue-700",children:M?"Update":"Create"}),(0,b.jsx)("button",{onClick:()=>{E(!1),$(null),S({name:"",description:"",permissions:[]})},className:"bg-gray-500 text-white px-3 py-2 rounded-md text-sm hover:bg-gray-600",children:"Cancel"})]})]})]})]})}),(0,b.jsx)("div",{className:"lg:col-span-3",children:i?(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,b.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-xl font-semibold text-gray-900",children:["Permissions for: ",i.name]}),i.description&&(0,b.jsx)("p",{className:"text-gray-600 mt-1",children:i.description})]}),(0,b.jsxs)("button",{onClick:async()=>{if(i)try{v(!0),console.log("\ud83d\udcbe Saving permissions for role:",i.name),console.log("\ud83d\udcbe Permissions being saved:",i.permissions),console.log("\ud83d\udcbe Permissions type:",typeof i.permissions);const n=await fetch(`/api/roles/${i.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i.name,description:i.description,permissions:i.permissions})});if(!n.ok)throw new Error("Failed to save permissions");{const i=await n.json();s(e.map(e=>e.id===i.id?i:e)),r(i),alert("Permissions saved successfully!")}}catch(n){w(n.message),alert("Error saving permissions: "+n.message)}finally{v(!1)}},disabled:j,className:"bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 disabled:opacity-50 flex items-center gap-2",children:[(0,b.jsx)(x.A,{size:16}),"Save Changes"]})]})}),(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)("div",{className:"space-y-4",children:0===T.length?(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("div",{className:"text-gray-400 mb-4",children:(0,b.jsx)(o.A,{size:48,className:"mx-auto"})}),(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Loading Permissions"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Please wait while permissions are loaded from the database..."})]}):T.map(e=>{const s=k.has(e.id),n=e.icon;return(0,b.jsxs)("div",{className:"border border-gray-200 rounded-lg",children:[(0,b.jsx)("div",{className:"p-4 bg-gray-50 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>(e=>{const s=new Set(k);s.has(e)?s.delete(e):s.add(e),A(s)})(e.id),children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(n,{className:"text-blue-600",size:20}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-medium text-gray-900",children:e.name}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"text-sm text-gray-500",children:[e.permissions.length," permissions"]}),s?(0,b.jsx)(u.A,{size:16}):(0,b.jsx)(f.A,{size:16})]})]})}),s&&(0,b.jsx)("div",{className:"p-4 border-t border-gray-200",children:(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.permissions.map(e=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:e.description})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,b.jsx)("input",{type:"checkbox",checked:O(i,e.name),onChange:s=>((e,n)=>{if(!i)return;let o;try{if("string"===typeof i.permissions?o=JSON.parse(i.permissions):Array.isArray(i.permissions)?o=[...i.permissions]:null===i.permissions||void 0===i.permissions?o={}:"object"!==typeof i.permissions||Array.isArray(i.permissions)?(console.warn("Unexpected permissions format:",i.permissions),o={}):o={...i.permissions},"object"===typeof o&&!Array.isArray(o))return o[e]=n,void r({...i,permissions:o});Array.isArray(o)||(console.warn("Permissions is not an array after parsing, resetting to empty array"),o=[]),n?o.includes(e)||o.push(e):o=o.filter(s=>s!==e),r({...i,permissions:o})}catch(s){console.error("Error parsing permissions:",s),o={},o[e]=n,r({...i,permissions:o})}})(e.name,s.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Allow"})]})]},e.id))})})]},e.id)})})})]}):(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[(0,b.jsx)("div",{className:"text-gray-400 mb-4",children:(0,b.jsx)(o.A,{size:48,className:"mx-auto"})}),(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a Role"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Choose a role from the left panel to manage its permissions"})]})})]}),N&&(0,b.jsx)("div",{className:"fixed bottom-4 right-4 bg-red-500 text-white px-4 py-2 rounded-md shadow-lg",children:N})]}):(0,b.jsx)("div",{className:"flex justify-center items-center h-64",children:"Loading permissions..."})};function v(){const{user:e}=(0,r.A)(),[s,i]=(0,n.useState)("roles");return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex justify-between items-center",children:(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Settings"})}),(0,b.jsx)("div",{className:"border-b border-gray-200",children:(0,b.jsx)("nav",{className:"-mb-px flex space-x-8",children:(0,b.jsx)("button",{onClick:()=>i("roles"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("roles"===s?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Roles & Permissions"})})}),"roles"===s&&(0,b.jsx)(j,{})]})}},6787:(e,s,i)=>{i.d(s,{A:()=>n});const n=(0,i(3797).A)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},6852:(e,s,i)=>{i.d(s,{A:()=>n});const n=(0,i(3797).A)("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]])}}]);
//# sourceMappingURL=833.a279c64c.chunk.js.map