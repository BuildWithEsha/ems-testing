"use strict";(self.webpackChunkemployee_management_system=self.webpackChunkemployee_management_system||[]).push([[46],{2046:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var r=s(5043),a=s(6339),i=s(5016),n=s(579);function d(){const{user:e}=(0,i.A)(),[t,s]=(0,r.useState)([]),[d,l]=(0,r.useState)([]),[o,c]=(0,r.useState)({department_id:"",task_id:"",severity:"High",description:"",issue_date:""}),[m,u]=(0,r.useState)(!1),[p,x]=(0,r.useState)([]),[g,h]=(0,r.useState)(""),[y,f]=(0,r.useState)([]),[b,j]=(0,r.useState)(!1);(0,r.useEffect)(()=>{e&&(async()=>{const t={};e&&(t["user-role"]=e.role||"employee",t["user-permissions"]=JSON.stringify("admin"===e.role||"Admin"===e.role?["all"]:e.permissions||[]),t["user-name"]=e.name||"");const[r,a]=await Promise.all([fetch("/api/departments"),fetch("/api/tasks?all=true",{headers:t})]);if(r.ok){const e=await r.json();s(Array.isArray(e.data)?e.data:Array.isArray(e)?e:[])}if(a.ok){const e=await a.json();console.log("Raw task data from API:",e);const t=Array.isArray(e.data)?e.data:Array.isArray(e)?e:[];console.log("Processed tasks array:",t),console.log("Number of tasks loaded:",t.length),l(t)}else console.error("Failed to fetch tasks:",a.status,a.statusText)})(),fetch("/api/issues").then(e=>e.ok?e.json():[]).then(x).catch(()=>{})},[e]);const w=(0,r.useMemo)(()=>{if(!o.department_id)return[];const e=(t||[]).find(e=>String(e.id)===String(o.department_id));if(!e)return[];const s=e.name;console.log("=== TASK FILTERING DEBUG ==="),console.log("Selected Department:",s),console.log("Department ID:",o.department_id),console.log("All tasks available:",d),console.log("Number of tasks:",(null===d||void 0===d?void 0:d.length)||0);const r=(d||[]).filter(e=>{if(console.log("Checking task:",e.title,"assigned_to:",e.assigned_to,"department:",e.department),e.assigned_to&&e.assigned_to.includes(s))return console.log("\u2713 Task matches by assigned_to field"),!0;if(e.department_id&&String(e.department_id)===String(o.department_id))return console.log("\u2713 Task matches by department_id field"),!0;if(e.department&&e.department===s)return console.log("\u2713 Task matches by department field"),!0;if(e.assigned_to){const t=e.assigned_to.toLowerCase(),r=s.toLowerCase();if(t.includes(r))return console.log("\u2713 Task matches by department name in assigned_to"),!0}return console.log("\u2717 Task does not match department"),!1});return console.log("Filtered tasks count:",r.length),console.log("Filtered tasks:",r),0===r.length?(console.log("No department-specific tasks found, showing all tasks as fallback"),d||[]):r},[o.department_id,t,d]),v=(0,r.useMemo)(()=>{const e=g.trim().toLowerCase();return e?p.filter(t=>(t.department_name||"").toLowerCase().includes(e)):p},[p,g]);return(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,n.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Department Issues"})}),(0,n.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!o.department_id||!o.task_id||!o.description.trim())return alert("All fields are required.");u(!0);try{const e=await fetch("/api/issues",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),t=await e.text();let s;try{s=JSON.parse(t)}catch{s={error:t}}if(!e.ok)throw new Error(s.error||"Failed to save");c({department_id:"",task_id:"",severity:"High",description:"",issue_date:""}),x(e=>[s.item,...e]),alert("Saved")}catch(t){alert(t.message)}finally{u(!1)}},className:"space-y-4 bg-white p-6 rounded-lg shadow-sm border",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department *"}),(0,n.jsxs)("select",{value:o.department_id,onChange:e=>c(t=>({...t,department_id:e.target.value,task_id:""})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0,children:[(0,n.jsx)("option",{value:"",children:"Select Department..."}),(t||[]).map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Task *"}),(0,n.jsxs)("select",{value:o.task_id,onChange:e=>c(t=>({...t,task_id:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 disabled:bg-gray-100",disabled:!o.department_id,required:!0,children:[(0,n.jsx)("option",{value:"",children:"Select Task..."}),w.map(e=>(0,n.jsx)("option",{value:e.id,children:e.title},e.id))]}),!o.department_id&&(0,n.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Please select a department first"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Issue Date"}),(0,n.jsx)("input",{type:"date",value:o.issue_date,onChange:e=>c(t=>({...t,issue_date:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Severity *"}),(0,n.jsxs)("select",{value:o.severity,onChange:e=>c(t=>({...t,severity:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0,children:[(0,n.jsx)("option",{value:"High",children:"High"}),(0,n.jsx)("option",{value:"Medium",children:"Medium"}),(0,n.jsx)("option",{value:"Low",children:"Low"})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),(0,n.jsx)("textarea",{value:o.description,onChange:e=>c(t=>({...t,description:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",rows:4,placeholder:"Describe the issue in detail...",required:!0})]}),(0,n.jsx)("div",{className:"flex justify-end pt-4",children:(0,n.jsx)("button",{type:"submit",disabled:m,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:m?"Saving...":"Save Issue"})})]}),(0,n.jsxs)("div",{className:"mt-8 bg-white rounded-lg shadow-sm border",children:[(0,n.jsxs)("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Issue Records"}),y.length>0&&(0,n.jsxs)("button",{onClick:async()=>{if(0!==y.length){if(confirm(`Are you sure you want to delete ${y.length} issue record(s)?`)){j(!0);try{const e=await fetch("/api/issues/bulk",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:y})});if(e.ok){const t=await e.json();x(e=>e.filter(e=>!y.includes(e.id))),f([]),alert(t.message)}else{const t=await e.json();alert(t.error||"Error deleting records")}}catch(e){console.error("Error bulk deleting issues:",e),alert("Error deleting records")}finally{j(!1)}}}else alert("Please select issues to delete")},disabled:b,className:"flex items-center px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,n.jsx)(a.A,{className:"w-4 h-4 mr-2"}),b?"Deleting...":`Delete Selected (${y.length})`]})]}),(0,n.jsx)("input",{type:"text",placeholder:"Search by department...",value:g,onChange:e=>h(e.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 w-64 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-6 py-3 text-left",children:(0,n.jsx)("input",{type:"checkbox",checked:v.length>0&&v.every(e=>y.includes(e.id)),onChange:()=>{const e=v.map(e=>e.id),t=e.every(e=>y.includes(e));f(t?t=>t.filter(t=>!e.includes(t)):t=>[...new Set([...t,...e])])},className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"})}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Task"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Severity"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Issue Date"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===v.length?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:"8",className:"px-6 py-8 text-center text-gray-500",children:"No issue records found"})}):v.map(e=>(0,n.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsx)("input",{type:"checkbox",checked:y.includes(e.id),onChange:()=>{return t=e.id,void f(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"})}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.department_name}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.task_title}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+("High"===e.severity?"bg-red-100 text-red-800":"Medium"===e.severity?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.severity})}),(0,n.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-xs truncate",title:e.description,children:e.description}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.issue_date?new Date(e.issue_date).toLocaleDateString():"-"}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleString()}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,n.jsx)("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this issue record?")){j(!0);try{const t=await fetch(`/api/issues/${e}`,{method:"DELETE"});if(t.ok)x(t=>t.filter(t=>t.id!==e)),f(t=>t.filter(t=>t!==e));else{const e=await t.json();alert(e.error||"Error deleting record")}}catch(t){console.error("Error deleting issue:",t),alert("Error deleting record")}finally{j(!1)}}})(e.id),disabled:b,className:"text-red-600 hover:text-red-900 disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete issue",children:(0,n.jsx)(a.A,{className:"w-4 h-4"})})})]},e.id))})]})})]})]})}}}]);
//# sourceMappingURL=46.03462caf.chunk.js.map