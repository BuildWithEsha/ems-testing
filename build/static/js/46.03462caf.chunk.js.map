{"version":3,"file":"static/js/46.03462caf.chunk.js","mappings":"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","sources":["components/views/Issues.js"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport { Trash2 } from 'lucide-react';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\n\r\nexport default function Issues() {\r\n  const { user } = useAuth();\r\n  const [departments, setDepartments] = useState([]);\r\n  const [tasks, setTasks] = useState([]);\r\n  const [form, setForm] = useState({ department_id: '', task_id: '', severity: 'High', description: '', issue_date: '' });\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [issues, setIssues] = useState([]);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedIssues, setSelectedIssues] = useState([]);\r\n  const [deleting, setDeleting] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const fetchInitial = async () => {\r\n      // Prepare headers with user permissions for the tasks request\r\n      const tasksHeaders = {};\r\n      if (user) {\r\n        tasksHeaders['user-role'] = user.role || 'employee';\r\n        tasksHeaders['user-permissions'] = JSON.stringify((user.role === 'admin' || user.role === 'Admin') ? ['all'] : (user.permissions || []));\r\n        tasksHeaders['user-name'] = user.name || '';\r\n      }\r\n      \r\n      const [deptRes, taskRes] = await Promise.all([\r\n        fetch('/api/departments'),\r\n        fetch('/api/tasks?all=true', { headers: tasksHeaders })\r\n      ]);\r\n      if (deptRes.ok) {\r\n        const deptData = await deptRes.json();\r\n        // Handle both paginated and non-paginated responses\r\n        setDepartments(Array.isArray(deptData.data) ? deptData.data : (Array.isArray(deptData) ? deptData : []));\r\n      }\r\n      if (taskRes.ok) {\r\n        const taskData = await taskRes.json();\r\n        console.log('Raw task data from API:', taskData);\r\n        // Handle both paginated and non-paginated responses\r\n        const tasksArray = Array.isArray(taskData.data) ? taskData.data : (Array.isArray(taskData) ? taskData : []);\r\n        console.log('Processed tasks array:', tasksArray);\r\n        console.log('Number of tasks loaded:', tasksArray.length);\r\n        setTasks(tasksArray);\r\n      } else {\r\n        console.error('Failed to fetch tasks:', taskRes.status, taskRes.statusText);\r\n      }\r\n    };\r\n    \r\n    if (user) {\r\n      fetchInitial();\r\n    }\r\n    fetch('/api/issues').then(r=>r.ok?r.json():[]).then(setIssues).catch(()=>{});\r\n  }, [user]);\r\n\r\n  const filteredTasks = useMemo(() => {\r\n    if (!form.department_id) return [];\r\n    const department = (departments || []).find(d => String(d.id) === String(form.department_id));\r\n    if (!department) return [];\r\n    const departmentName = department.name;\r\n    \r\n    console.log('=== TASK FILTERING DEBUG ===');\r\n    console.log('Selected Department:', departmentName);\r\n    console.log('Department ID:', form.department_id);\r\n    console.log('All tasks available:', tasks);\r\n    console.log('Number of tasks:', tasks?.length || 0);\r\n    \r\n    // Filter tasks by department\r\n    const filtered = (tasks || []).filter(task => {\r\n      console.log('Checking task:', task.title, 'assigned_to:', task.assigned_to, 'department:', task.department);\r\n      \r\n      // Check if task has assigned_to field and it contains department name\r\n      if (task.assigned_to && task.assigned_to.includes(departmentName)) {\r\n        console.log('✓ Task matches by assigned_to field');\r\n        return true;\r\n      }\r\n      \r\n      // Alternative: Check if task has department_id field\r\n      if (task.department_id && String(task.department_id) === String(form.department_id)) {\r\n        console.log('✓ Task matches by department_id field');\r\n        return true;\r\n      }\r\n      \r\n      // Alternative: Check if task has department field\r\n      if (task.department && task.department === departmentName) {\r\n        console.log('✓ Task matches by department field');\r\n        return true;\r\n      }\r\n      \r\n      // Check if assigned_to contains any employee from this department\r\n      if (task.assigned_to) {\r\n        // This is a more complex check - we'd need to get employees from this department\r\n        // For now, let's be more permissive and show tasks that might be related\r\n        const assignedToLower = task.assigned_to.toLowerCase();\r\n        const departmentNameLower = departmentName.toLowerCase();\r\n        \r\n        // Check if department name appears in assigned_to (case insensitive)\r\n        if (assignedToLower.includes(departmentNameLower)) {\r\n          console.log('✓ Task matches by department name in assigned_to');\r\n          return true;\r\n        }\r\n      }\r\n      \r\n      console.log('✗ Task does not match department');\r\n      return false;\r\n    });\r\n    \r\n    console.log('Filtered tasks count:', filtered.length);\r\n    console.log('Filtered tasks:', filtered);\r\n    \r\n    // If no department-specific tasks found, show all tasks as fallback\r\n    if (filtered.length === 0) {\r\n      console.log('No department-specific tasks found, showing all tasks as fallback');\r\n      return tasks || [];\r\n    }\r\n    \r\n    return filtered;\r\n  }, [form.department_id, departments, tasks]);\r\n\r\n  const displayedIssues = useMemo(() => {\r\n    const q = searchTerm.trim().toLowerCase();\r\n    if (!q) return issues;\r\n    return issues.filter(i => (i.department_name || '').toLowerCase().includes(q));\r\n  }, [issues, searchTerm]);\r\n\r\n  const submit = async (e) => {\r\n    e.preventDefault();\r\n    if (!form.department_id || !form.task_id || !form.description.trim()) return alert('All fields are required.');\r\n    setSubmitting(true);\r\n    try {\r\n      const res = await fetch('/api/issues', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(form)\r\n      });\r\n      const text = await res.text();\r\n      let data;\r\n      try { data = JSON.parse(text); } catch { data = { error: text }; }\r\n      if (!res.ok) throw new Error(data.error || 'Failed to save');\r\n      setForm({ department_id: '', task_id: '', severity: 'High', description: '', issue_date: '' });\r\n      setIssues(prev => [data.item, ...prev]);\r\n      alert('Saved');\r\n    } catch (err) {\r\n      alert(err.message);\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  // Handle individual delete\r\n  const handleDelete = async (id) => {\r\n    if (!confirm('Are you sure you want to delete this issue record?')) return;\r\n    \r\n    setDeleting(true);\r\n    try {\r\n      const response = await fetch(`/api/issues/${id}`, {\r\n        method: 'DELETE',\r\n      });\r\n      \r\n      if (response.ok) {\r\n        setIssues(prev => prev.filter(issue => issue.id !== id));\r\n        setSelectedIssues(prev => prev.filter(selectedId => selectedId !== id));\r\n      } else {\r\n        const error = await response.json();\r\n        alert(error.error || 'Error deleting record');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error deleting issue:', error);\r\n      alert('Error deleting record');\r\n    } finally {\r\n      setDeleting(false);\r\n    }\r\n  };\r\n\r\n  // Handle bulk delete\r\n  const handleBulkDelete = async () => {\r\n    if (selectedIssues.length === 0) {\r\n      alert('Please select issues to delete');\r\n      return;\r\n    }\r\n    \r\n    if (!confirm(`Are you sure you want to delete ${selectedIssues.length} issue record(s)?`)) return;\r\n    \r\n    setDeleting(true);\r\n    try {\r\n      const response = await fetch('/api/issues/bulk', {\r\n        method: 'DELETE',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ ids: selectedIssues }),\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const result = await response.json();\r\n        setIssues(prev => prev.filter(issue => !selectedIssues.includes(issue.id)));\r\n        setSelectedIssues([]);\r\n        alert(result.message);\r\n      } else {\r\n        const error = await response.json();\r\n        alert(error.error || 'Error deleting records');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error bulk deleting issues:', error);\r\n      alert('Error deleting records');\r\n    } finally {\r\n      setDeleting(false);\r\n    }\r\n  };\r\n\r\n  // Handle individual checkbox change\r\n  const handleSelectIssue = (issueId) => {\r\n    setSelectedIssues(prev => {\r\n      const newSelected = prev.includes(issueId)\r\n        ? prev.filter(id => id !== issueId)\r\n        : [...prev, issueId];\r\n      return newSelected;\r\n    });\r\n  };\r\n\r\n  // Handle select all checkbox\r\n  const handleSelectAll = () => {\r\n    const allDisplayedIds = displayedIssues.map(issue => issue.id);\r\n    const allSelected = allDisplayedIds.every(id => selectedIssues.includes(id));\r\n    \r\n    if (allSelected) {\r\n      setSelectedIssues(prev => prev.filter(id => !allDisplayedIds.includes(id)));\r\n    } else {\r\n      setSelectedIssues(prev => [...new Set([...prev, ...allDisplayedIds])]);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <h1 className=\"text-2xl font-semibold text-gray-900\">Department Issues</h1>\r\n      </div>\r\n\r\n      <form onSubmit={submit} className=\"space-y-4 bg-white p-6 rounded-lg shadow-sm border\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Department *</label>\r\n            <select \r\n              value={form.department_id} \r\n              onChange={e=>setForm(f=>({...f, department_id: e.target.value, task_id: ''}))} \r\n              className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\r\n              required\r\n            >\r\n              <option value=\"\">Select Department...</option>\r\n              {(departments || []).map(dept => <option key={dept.id} value={dept.id}>{dept.name}</option>)}\r\n            </select>\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Task *</label>\r\n            <select \r\n              value={form.task_id} \r\n              onChange={e=>setForm(f=>({...f, task_id: e.target.value}))} \r\n              className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 disabled:bg-gray-100\" \r\n              disabled={!form.department_id}\r\n              required\r\n            >\r\n              <option value=\"\">Select Task...</option>\r\n              {filteredTasks.map(task => <option key={task.id} value={task.id}>{task.title}</option>)}\r\n            </select>\r\n            {!form.department_id && (\r\n              <p className=\"text-xs text-gray-500 mt-1\">Please select a department first</p>\r\n            )}\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Issue Date</label>\r\n            <input \r\n              type=\"date\" \r\n              value={form.issue_date} \r\n              onChange={e=>setForm(f=>({...f, issue_date: e.target.value}))} \r\n              className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\" \r\n            />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Severity *</label>\r\n            <select \r\n              value={form.severity} \r\n              onChange={e=>setForm(f=>({...f, severity: e.target.value}))} \r\n              className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\r\n              required\r\n            >\r\n              <option value=\"High\">High</option>\r\n              <option value=\"Medium\">Medium</option>\r\n              <option value=\"Low\">Low</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Description *</label>\r\n          <textarea \r\n            value={form.description} \r\n            onChange={e=>setForm(f=>({...f, description: e.target.value}))} \r\n            className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\" \r\n            rows={4} \r\n            placeholder=\"Describe the issue in detail...\"\r\n            required\r\n          />\r\n        </div>\r\n        <div className=\"flex justify-end pt-4\">\r\n          <button \r\n            type=\"submit\" \r\n            disabled={submitting} \r\n            className=\"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200\"\r\n          >\r\n            {submitting ? 'Saving...' : 'Save Issue'}\r\n          </button>\r\n        </div>\r\n      </form>\r\n\r\n      <div className=\"mt-8 bg-white rounded-lg shadow-sm border\">\r\n        <div className=\"px-6 py-4 border-b flex items-center justify-between\">\r\n          <div className=\"flex items-center space-x-4\">\r\n            <h2 className=\"text-lg font-semibold text-gray-900\">Issue Records</h2>\r\n            {selectedIssues.length > 0 && (\r\n              <button\r\n                onClick={handleBulkDelete}\r\n                disabled={deleting}\r\n                className=\"flex items-center px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed\"\r\n              >\r\n                <Trash2 className=\"w-4 h-4 mr-2\" />\r\n                {deleting ? 'Deleting...' : `Delete Selected (${selectedIssues.length})`}\r\n              </button>\r\n            )}\r\n          </div>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Search by department...\"\r\n            value={searchTerm}\r\n            onChange={(e)=>setSearchTerm(e.target.value)}\r\n            className=\"border border-gray-300 rounded-lg px-3 py-2 w-64 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500\"\r\n          />\r\n        </div>\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full divide-y divide-gray-200\">\r\n            <thead className=\"bg-gray-50\">\r\n              <tr>\r\n                <th className=\"px-6 py-3 text-left\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={displayedIssues.length > 0 && displayedIssues.every(issue => selectedIssues.includes(issue.id))}\r\n                    onChange={handleSelectAll}\r\n                    className=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\r\n                  />\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Department</th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Task</th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Severity</th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Description</th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Issue Date</th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Created</th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"bg-white divide-y divide-gray-200\">\r\n              {displayedIssues.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan=\"8\" className=\"px-6 py-8 text-center text-gray-500\">\r\n                    No issue records found\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                displayedIssues.map(issue => (\r\n                  <tr key={issue.id} className=\"hover:bg-gray-50\">\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={selectedIssues.includes(issue.id)}\r\n                        onChange={() => handleSelectIssue(issue.id)}\r\n                        className=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\r\n                      />\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{issue.department_name}</td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">{issue.task_title}</td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${\r\n                        issue.severity === 'High' ? 'bg-red-100 text-red-800' :\r\n                        issue.severity === 'Medium' ? 'bg-yellow-100 text-yellow-800' :\r\n                        'bg-green-100 text-green-800'\r\n                      }`}>\r\n                        {issue.severity}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 text-sm text-gray-900 max-w-xs truncate\" title={issue.description}>{issue.description}</td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">{issue.issue_date ? new Date(issue.issue_date).toLocaleDateString() : '-'}</td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">{new Date(issue.created_at).toLocaleString()}</td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\r\n                      <button\r\n                        onClick={() => handleDelete(issue.id)}\r\n                        disabled={deleting}\r\n                        className=\"text-red-600 hover:text-red-900 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                        title=\"Delete issue\"\r\n                      >\r\n                        <Trash2 className=\"w-4 h-4\" />\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                ))\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["Issues","user","useAuth","departments","setDepartments","useState","tasks","setTasks","form","setForm","department_id","task_id","severity","description","issue_date","submitting","setSubmitting","issues","setIssues","searchTerm","setSearchTerm","selectedIssues","setSelectedIssues","deleting","setDeleting","useEffect","async","tasksHeaders","role","JSON","stringify","permissions","name","deptRes","taskRes","Promise","all","fetch","headers","ok","deptData","json","Array","isArray","data","taskData","console","log","tasksArray","length","error","status","statusText","fetchInitial","then","r","catch","filteredTasks","useMemo","department","find","d","String","id","departmentName","filtered","filter","task","title","assigned_to","includes","assignedToLower","toLowerCase","departmentNameLower","displayedIssues","q","trim","i","department_name","_jsxs","className","children","_jsx","onSubmit","e","preventDefault","alert","res","method","body","text","parse","Error","prev","item","err","message","value","onChange","f","target","required","map","dept","disabled","type","rows","placeholder","onClick","confirm","response","ids","result","issue","Trash2","checked","every","handleSelectAll","allDisplayedIds","allSelected","Set","colSpan","handleSelectIssue","issueId","task_title","Date","toLocaleDateString","created_at","toLocaleString","selectedId","handleDelete"],"sourceRoot":""}