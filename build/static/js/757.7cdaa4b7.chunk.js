"use strict";(self.webpackChunkemployee_management_system=self.webpackChunkemployee_management_system||[]).push([[757],{5757:(e,r,t)=>{t.r(r),t.d(r,{default:()=>d});var s=t(5043),i=t(6339),a=t(5016),l=t(579);function d(){const{user:e}=(0,a.A)(),[r,t]=(0,s.useState)([]),[d,o]=(0,s.useState)([]),[n,c]=(0,s.useState)({employee_id:"",task_id:"",severity:"High",description:"",error_date:""}),[x,m]=(0,s.useState)(!1),[p,u]=(0,s.useState)([]),[g,h]=(0,s.useState)(""),[y,f]=(0,s.useState)([]),[b,j]=(0,s.useState)(!1);(0,s.useEffect)(()=>{e&&(async()=>{const r={};e&&(r["user-role"]=e.role||"employee",r["user-permissions"]=JSON.stringify("admin"===e.role||"Admin"===e.role?["all"]:e.permissions||[]),r["user-name"]=e.name||"");const[s,i]=await Promise.all([fetch("/api/employees"),fetch("/api/tasks",{headers:r})]);if(s.ok){const e=await s.json();t(Array.isArray(e.data)?e.data:Array.isArray(e)?e:[])}if(i.ok){const e=await i.json();o(Array.isArray(e.data)?e.data:Array.isArray(e)?e:[])}})(),fetch("/api/errors").then(e=>e.ok?e.json():[]).then(u).catch(()=>{})},[e]);const w=(0,s.useMemo)(()=>{if(!n.employee_id)return[];const e=(r||[]).find(e=>String(e.id)===String(n.employee_id));if(!e)return[];const t=e.name;return(d||[]).filter(e=>e.assigned_to&&e.assigned_to.includes(t))},[n.employee_id,r,d]),v=(0,s.useMemo)(()=>{const e=g.trim().toLowerCase();return e?p.filter(r=>(r.employee_name||"").toLowerCase().includes(e)):p},[p,g]);return(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,l.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Employee Errors"})}),(0,l.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!n.employee_id||!n.task_id||!n.description.trim())return alert("All fields are required.");m(!0);try{const e=await fetch("/api/errors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),r=await e.text();let t;try{t=JSON.parse(r)}catch{t={error:r}}if(!e.ok)throw new Error(t.error||"Failed to save");c({employee_id:"",task_id:"",severity:"High",description:"",error_date:""}),u(e=>[t.item,...e]),alert("Saved")}catch(r){alert(r.message)}finally{m(!1)}},className:"space-y-4 bg-white p-6 rounded-lg shadow-sm border",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee *"}),(0,l.jsxs)("select",{value:n.employee_id,onChange:e=>c(r=>({...r,employee_id:e.target.value,task_id:""})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0,children:[(0,l.jsx)("option",{value:"",children:"Select Employee..."}),(r||[]).map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Task *"}),(0,l.jsxs)("select",{value:n.task_id,onChange:e=>c(r=>({...r,task_id:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 disabled:bg-gray-100",disabled:!n.employee_id,required:!0,children:[(0,l.jsx)("option",{value:"",children:"Select Task..."}),w.map(e=>(0,l.jsx)("option",{value:e.id,children:e.title},e.id))]}),!n.employee_id&&(0,l.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Please select an employee first"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Error Date"}),(0,l.jsx)("input",{type:"date",value:n.error_date,onChange:e=>c(r=>({...r,error_date:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Severity *"}),(0,l.jsxs)("select",{value:n.severity,onChange:e=>c(r=>({...r,severity:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0,children:[(0,l.jsx)("option",{value:"High",children:"High"}),(0,l.jsx)("option",{value:"Medium",children:"Medium"}),(0,l.jsx)("option",{value:"Low",children:"Low"})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),(0,l.jsx)("textarea",{value:n.description,onChange:e=>c(r=>({...r,description:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",rows:4,placeholder:"Describe the error in detail...",required:!0})]}),(0,l.jsx)("div",{className:"flex justify-end pt-4",children:(0,l.jsx)("button",{type:"submit",disabled:x,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:x?"Saving...":"Save Error"})})]}),(0,l.jsxs)("div",{className:"mt-8 bg-white rounded-lg shadow-sm border",children:[(0,l.jsxs)("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Error Records"}),y.length>0&&(0,l.jsxs)("button",{onClick:async()=>{if(0!==y.length){if(confirm(`Are you sure you want to delete ${y.length} error record(s)?`)){j(!0);try{const e=await fetch("/api/errors/bulk",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:y})});if(e.ok){const r=await e.json();u(e=>e.filter(e=>!y.includes(e.id))),f([]),alert(r.message)}else{const r=await e.json();alert(r.error||"Error deleting records")}}catch(e){console.error("Error bulk deleting errors:",e),alert("Error deleting records")}finally{j(!1)}}}else alert("Please select errors to delete")},disabled:b,className:"flex items-center px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,l.jsx)(i.A,{className:"w-4 h-4 mr-2"}),b?"Deleting...":`Delete Selected (${y.length})`]})]}),(0,l.jsx)("input",{type:"text",placeholder:"Search by employee...",value:g,onChange:e=>h(e.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 w-64 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,l.jsx)("thead",{className:"bg-gray-50",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-6 py-3 text-left",children:(0,l.jsx)("input",{type:"checkbox",checked:v.length>0&&v.every(e=>y.includes(e.id)),onChange:()=>{const e=v.map(e=>e.id),r=e.every(e=>y.includes(e));f(r?r=>r.filter(r=>!e.includes(r)):r=>[...new Set([...r,...e])])},className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"})}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Task"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Severity"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Error Date"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,l.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===v.length?(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:"8",className:"px-6 py-8 text-center text-gray-500",children:"No error records found"})}):v.map(e=>(0,l.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,l.jsx)("input",{type:"checkbox",checked:y.includes(e.id),onChange:()=>{return r=e.id,void f(e=>e.includes(r)?e.filter(e=>e!==r):[...e,r]);var r},className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"})}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.employee_name}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.task_title}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,l.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+("High"===e.severity?"bg-red-100 text-red-800":"Medium"===e.severity?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.severity})}),(0,l.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-xs truncate",title:e.description,children:e.description}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.error_date?new Date(e.error_date).toLocaleDateString():"-"}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleString()}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,l.jsx)("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this error record?")){j(!0);try{const r=await fetch(`/api/errors/${e}`,{method:"DELETE"});if(r.ok)u(r=>r.filter(r=>r.id!==e)),f(r=>r.filter(r=>r!==e));else{const e=await r.json();alert(e.error||"Error deleting record")}}catch(r){console.error("Error deleting error:",r),alert("Error deleting record")}finally{j(!1)}}})(e.id),disabled:b,className:"text-red-600 hover:text-red-900 disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete error",children:(0,l.jsx)(i.A,{className:"w-4 h-4"})})})]},e.id))})]})})]})]})}}}]);
//# sourceMappingURL=757.7cdaa4b7.chunk.js.map